<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<title data-react-helmet="true">Google Cloud Platform GKE | Deploy Kubernetes Operator</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/gcp-gke"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Google Cloud Platform GKE | Deploy Kubernetes Operator"><meta data-react-helmet="true" name="description" content="Here it will be described how to install manually Deploy k8s cluster with help of operator to GCP GKE."><meta data-react-helmet="true" property="og:description" content="Here it will be described how to install manually Deploy k8s cluster with help of operator to GCP GKE."><link data-react-helmet="true" rel="shortcut icon" href="/xl-deploy-kubernetes-operator/img/digital_ai_deploy.svg"><link data-react-helmet="true" rel="canonical" href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/gcp-gke"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/gcp-gke" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/gcp-gke" hreflang="x-default"><link rel="stylesheet" href="/xl-deploy-kubernetes-operator/assets/css/styles.22a8eaea.css">
<link rel="preload" href="/xl-deploy-kubernetes-operator/assets/js/runtime~main.a891f62a.js" as="script">
<link rel="preload" href="/xl-deploy-kubernetes-operator/assets/js/main.c3b13f3d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/xl-deploy-kubernetes-operator/"><div class="navbar__logo"><img src="/xl-deploy-kubernetes-operator/img/digital_ai_deploy.svg" alt="Deploy Kubernetes Operator Digital.ai" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/xl-deploy-kubernetes-operator/img/digital_ai_deploy.svg" alt="Deploy Kubernetes Operator Digital.ai" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Deploy Kubernetes Operator</b></a><a class="navbar__item navbar__link navbar__link--active" href="/xl-deploy-kubernetes-operator/docs/intro">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/xebialabs/xl-deploy-kubernetes-operator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-operator/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-operator/docs/scaffolding">Scaffolding</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Manual installation</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/onprem">On Premises</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/openshift">AWS OpenShift</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/aws-eks">AWS EKS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/azure-aks">Azure AKS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/gcp-gke">Google Cloud Platform GKE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/updating-configuration-files">Updating configuration files on Deploy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/updating-truststore-files">Adding truststore files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/setting-up-custom-namespace">Setting up custom namespace</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/change-namespace-for-xld-10.3-with-parallel">A. How to change namespace in case there is deploy already running in the default namespace - parallel option</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/change-namespace-for-xld-10.3-with-downtime">B. How to change namespace in case there is deploy already running in the default namespace - with downtime</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/move_pvc_to_other_namespace">C. How to change namespace of the PVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/manual-upgrade-for-xld-10">Manual helm to operator upgrade of xld from version 10 to above 22.1 version.</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Google Cloud Platform GKE</h1></header><p>Here it will be described how to install manually Deploy k8s cluster with help of operator to GCP GKE.</p><ul><li>You should install <a href="https://cloud.google.com/sdk/docs/install" target="_blank" rel="noopener noreferrer">gcloud CLI locally</a></li><li>Use kubernetes walkthrough, in the next section with <code>gcloud</code> to setup k8s cluster. Here are more detailed description: <a href="https://cloud.google.com/kubernetes-engine/docs/quickstart" target="_blank" rel="noopener noreferrer">Quickstart</a></li><li>Login with <code>gcloud</code> cli with your google account and <a href="https://cloud.google.com/resource-manager/docs/creating-managing-projects" target="_blank" rel="noopener noreferrer">select or create project</a>  </li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="create-the-cluster">Create the cluster<a aria-hidden="true" class="hash-link" href="#create-the-cluster" title="Direct link to heading">​</a></h2><p>Here are basic steps to setup k8s cluster</p><ul><li>3 nodes</li><li>machine type: <code>e2-standard-2</code> - 2vCPUs, 8GB</li><li>Kubernetes version: <code>1.20.11-gke.1801</code></li><li>with GcePersistentDiskCsiDriver addon to enable <code>standard-rwo</code> StorageClass</li></ul><p>Create an GCP GKE cluster</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ gcloud beta container --account </span><span class="token string" style="color:#e3116c">&quot;user@gmail.com&quot;</span><span class="token plain"> --project </span><span class="token string" style="color:#e3116c">&quot;apollo-playground&quot;</span><span class="token plain"> clusters create </span><span class="token string" style="color:#e3116c">&quot;gcp-gke-test-cluster&quot;</span><span class="token plain"> --zone  </span><span class="token string" style="color:#e3116c">&quot;us-central1-a&quot;</span><span class="token plain"> --release-channel </span><span class="token string" style="color:#e3116c">&quot;regular&quot;</span><span class="token plain"> --num-nodes </span><span class="token string" style="color:#e3116c">&quot;3&quot;</span><span class="token plain"> --machine-type </span><span class="token string" style="color:#e3116c">&quot;e2-standard-2&quot;</span><span class="token plain"> --cluster-version </span><span class="token string" style="color:#e3116c">&quot;1.20.11-gke.1801&quot;</span><span class="token plain"> --image-type </span><span class="token string" style="color:#e3116c">&quot;COS_CONTAINERD&quot;</span><span class="token plain"> --metadata disable-legacy-endpoints</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true --logging</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">SYSTEM,WORKLOAD --monitoring</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">SYSTEM --enable-ip-alias --no-enable-master-authorized-networks --addons HorizontalPodAutoscaling,HttpLoadBalancing,GcePersistentDiskCsiDriver --enable-autoupgrade --enable-autorepair --enable-shielded-nodes </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                  LOCATION       MASTER_VERSION    MASTER_IP      MACHINE_TYPE   NODE_VERSION      NUM_NODES  STATUS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcp-gke-test-cluster  us-central1-a  </span><span class="token number" style="color:#36acaa">1.20</span><span class="token plain">.11-gke.1801  </span><span class="token number" style="color:#36acaa">34.121</span><span class="token plain">.95.175  e2-standard-2  </span><span class="token number" style="color:#36acaa">1.20</span><span class="token plain">.11-gke.1801  </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">          RUNNING</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: The Pod address range limits the maximum size of the cluster. Please refer to https://cloud.google.com/kubernetes-engine/docs/how-to/flexible-pod-cidr to learn how to optimize IP address allocation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating cluster gcp-gke-test-cluster </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> us-central1-a</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">https://container.googleapis.com/v1beta1/projects/apollo-playground/zones/us-central1-a/clusters/gcp-gke-test-cluster</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To inspect the contents of your cluster, go to: https://console.cloud.google.com/kubernetes/workload_/gcloud/us-central1-a/gcp-gke-test-cluster?project</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">apollo-playground</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeconfig entry generated </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> gcp-gke-test-cluster.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Result on the GCP console:
<img alt="gke-cluster-list" src="/xl-deploy-kubernetes-operator/assets/images/gke-cluster-list-e3151927149887c9913cfce690d8d447.png"></p><p>Connect to the cluster</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ gcloud beta container --account </span><span class="token string" style="color:#e3116c">&quot;user@gmail.com&quot;</span><span class="token plain"> --project </span><span class="token string" style="color:#e3116c">&quot;apollo-playground&quot;</span><span class="token plain"> clusters get-credentials </span><span class="token string" style="color:#e3116c">&quot;gcp-gke-test-cluster&quot;</span><span class="token plain"> --zone </span><span class="token string" style="color:#e3116c">&quot;us-central1-a&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fetching cluster endpoint and auth data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeconfig entry generated </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> gcp-gke-test-cluster.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Check if your cluster is fully functional</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ kubectl get node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                  STATUS   ROLES    AGE   VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gke-gcp-gke-test-cluster-default-pool-d354d6a9-0627   Ready    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   35m   v1.20.11-gke.1801</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gke-gcp-gke-test-cluster-default-pool-d354d6a9-0ljz   Ready    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   35m   v1.20.11-gke.1801</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gke-gcp-gke-test-cluster-default-pool-d354d6a9-bgfb   Ready    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   35m   v1.20.11-gke.1801</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can take now the keys and URL and update <code>deploy-operator-gcp-gke/digitalai-deploy/infrastructure.yaml</code>. Following are mappings:</p><table><thead><tr><th align="center">Field name</th><th align="center">Path to the cert</th></tr></thead><tbody><tr><td align="center">apiServerURL</td><td align="center">~/.kube/config:clusters<!-- -->[<!-- -->name=gke_apollo-playground_us-central1-a_gcp-gke-test-cluster<!-- -->]<!-- -->.cluster.server</td></tr><tr><td align="center">caCert</td><td align="center">~/.kube/config:clusters<!-- -->[<!-- -->name=gke_apollo-playground_us-central1-a_gcp-gke-test-cluster<!-- -->]<!-- -->.cluster.certificate-authority-data</td></tr><tr><td align="center">token</td><td align="center">~/.kube/config:users<!-- -->[<!-- -->name=gke_apollo-playground_us-central1-a_gcp-gke-test-cluster<!-- -->]<!-- -->.user.auth-provider.config.access-token</td></tr></tbody></table><p>You can use base64 encoded values from the <code>~/.kube/config</code>, as is, in that case, from the <code>infrastructure.yaml</code>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="storage-class">Storage class<a aria-hidden="true" class="hash-link" href="#storage-class" title="Direct link to heading">​</a></h2><p>Get default storage class</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ kubectl get storageclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME           PROVISIONER             RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">premium-rwo    pd.csi.storage.gke.io   Delete          WaitForFirstConsumer   </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                   49m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">standard       kubernetes.io/gce-pd    Delete          Immediate              </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                   49m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">standard-rwo   pd.csi.storage.gke.io   Delete          WaitForFirstConsumer   </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                   49m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>It is already set in the <code>daideploy_cr.yaml</code>.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="compute-engine-persistent-disk-csi-driver">Compute Engine persistent disk CSI Driver<a aria-hidden="true" class="hash-link" href="#compute-engine-persistent-disk-csi-driver" title="Direct link to heading">​</a></h3><p>When during cluster creation we have enabled addon <code>GcePersistentDiskCsiDriver</code>, it can be enabled after creation too:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ gcloud container clusters update &quot;gcp-gke-test-cluster&quot; --update-addons=GcePersistentDiskCsiDriver=ENABLED</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>There are enabled 2 storage classes:</p><ul><li>standard-rwo</li><li>premium-rwo</li></ul><p>Update the storageClass in the <code>daideploy_cr.yaml</code> to <code>standard-rwo</code> on paths:</p><ul><li><code>spec.postgresql.persistence.storageClass</code></li><li><code>spec.rabbitmq.persistence.storageClass</code>.</li></ul><p>For details check <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/persistent-volumes/gce-pd-csi-driver" target="_blank" rel="noopener noreferrer">Using the Compute Engine persistent disk CSI Driver</a></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="start-operator">Start operator<a aria-hidden="true" class="hash-link" href="#start-operator" title="Direct link to heading">​</a></h2><p>To be able to connect to deploy via Google&#x27;s Endpoints, update <code>daideploy_cr.yaml</code> on following places:</p><ul><li><code>spec.ingress.hosts</code> update first element to <code>gcp-gke-test-cluster.endpoints.apollo-playground.cloud.goog</code></li><li><code>spec.route.hosts</code> update first element to <code>gcp-gke-test-cluster</code></li></ul><p>Run following command</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">xl apply -v -f digital-ai.yaml </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Check services in shell:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ kubectl get services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                               TYPE           CLUSTER-IP    EXTERNAL-IP     PORT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">S</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                                 AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dai-xld-digitalai-deploy-lb                        ClusterIP      </span><span class="token number" style="color:#36acaa">10.8</span><span class="token plain">.1.157    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">          </span><span class="token number" style="color:#36acaa">4516</span><span class="token plain">/TCP                                48m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dai-xld-digitalai-deploy-master                    ClusterIP      None          </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">          </span><span class="token number" style="color:#36acaa">8180</span><span class="token plain">/TCP                                48m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dai-xld-digitalai-deploy-worker                    ClusterIP      None          </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">          </span><span class="token number" style="color:#36acaa">8180</span><span class="token plain">/TCP                                48m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dai-xld-nginx-ingress-controller                   LoadBalancer   </span><span class="token number" style="color:#36acaa">10.8</span><span class="token plain">.0.3      </span><span class="token number" style="color:#36acaa">34.123</span><span class="token plain">.52.153   </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">:30407/TCP,443:32022/TCP              48m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dai-xld-nginx-ingress-controller-default-backend   ClusterIP      </span><span class="token number" style="color:#36acaa">10.8</span><span class="token plain">.14.173   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">          </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">/TCP                                  48m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dai-xld-postgresql                                 ClusterIP      </span><span class="token number" style="color:#36acaa">10.8</span><span class="token plain">.8.82     </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">          </span><span class="token number" style="color:#36acaa">5432</span><span class="token plain">/TCP                                48m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dai-xld-postgresql-headless                        ClusterIP      None          </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">          </span><span class="token number" style="color:#36acaa">5432</span><span class="token plain">/TCP                                48m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dai-xld-rabbitmq                                   ClusterIP      </span><span class="token number" style="color:#36acaa">10.8</span><span class="token plain">.1.116    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">          </span><span class="token number" style="color:#36acaa">5672</span><span class="token plain">/TCP,4369/TCP,25672/TCP,15672/TCP   48m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dai-xld-rabbitmq-headless                          ClusterIP      None          </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">          </span><span class="token number" style="color:#36acaa">4369</span><span class="token plain">/TCP,5672/TCP,25672/TCP,15672/TCP   48m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubernetes                                         ClusterIP      </span><span class="token number" style="color:#36acaa">10.8</span><span class="token plain">.0.1      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">          </span><span class="token number" style="color:#36acaa">443</span><span class="token plain">/TCP                                 51m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The final result on GCP console, all should be running (running all with 1 master and 2 worker replicas) with list of pods and services :
<img alt="gke-services" src="/xl-deploy-kubernetes-operator/assets/images/gke-services-131900d29ff3219619ab16b8335052ef.png"></p><p><img alt="gke-ingress" src="/xl-deploy-kubernetes-operator/assets/images/gke-ingress-bf49e411ce410423b45e6a333fa31ff0.png"></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="troubleshouting">Troubleshouting<a aria-hidden="true" class="hash-link" href="#troubleshouting" title="Direct link to heading">​</a></h3><p>If you work for longer period on the same cluster, token that is used is possible to expire. Use following 2 commands to get new token:</p><ul><li>first one to get new context for the cluster:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ gcloud beta container --account </span><span class="token string" style="color:#e3116c">&quot;user@gmail.com&quot;</span><span class="token plain"> --project </span><span class="token string" style="color:#e3116c">&quot;apollo-playground&quot;</span><span class="token plain"> --zone </span><span class="token string" style="color:#e3116c">&quot;us-central1-a&quot;</span><span class="token plain"> clusters get-credentials </span><span class="token string" style="color:#e3116c">&quot;gcp-gke-test-cluster&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>second one to get access token value:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ gcloud auth application-default print-access-token</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>With new access token value update in the xl-deploy that used for operator deployment, on CI <code>Infrastructure/k8s-infra/xld</code> property <code>token</code>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="setting-up-google-cloud-endpoints-to-use-googles-dns">Setting up Google Cloud Endpoints to use Google&#x27;s DNS<a aria-hidden="true" class="hash-link" href="#setting-up-google-cloud-endpoints-to-use-googles-dns" title="Direct link to heading">​</a></h2><p>Here we will setup Google Cloud Endpoints. For setting up details check <a href="https://cloud.google.com/endpoints/docs/openapi/deploy-endpoints-config" target="_blank" rel="noopener noreferrer">Deploying the Endpoints configuration</a></p><p>The final URL will be in the following example: <a href="http://gcp-gke-test-cluster.endpoints.apollo-playground.cloud.goog/xl-deploy/#/explorer" target="_blank" rel="noopener noreferrer">http://gcp-gke-test-cluster.endpoints.apollo-playground.cloud.goog/xl-deploy/#/explorer</a></p><p>After successful startup of the operator, check following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ kubectl get ing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                       CLASS    HOSTS                                                         ADDRESS        PORTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dai-xld-digitalai-deploy   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   gcp-gke-test-cluster.endpoints.apollo-playground.cloud.goog   </span><span class="token number" style="color:#36acaa">34.70</span><span class="token plain">.40.169   </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">      92m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Hosts should be same as we set <code>spec.ingress.hosts</code>.</p><p>Get the IP of deployed application</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ kubectl get service/dai-xld-nginx-ingress-controller -o </span><span class="token string" style="color:#e3116c">&quot;jsonpath={.status.loadBalancer.ingress[*].ip}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">34.123</span><span class="token plain">.52.153</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Create file <code>dns-openapi.yaml</code> to specify google cloud endpoint with correct IP from previous command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">swagger: &quot;2.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">host: &quot;gcp-gke-test-cluster.endpoints.apollo-playground.cloud.goog&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-google-endpoints:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- name: &quot;gcp-gke-test-cluster.endpoints.apollo-playground.cloud.goog&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  target: &quot;34.123.52.153&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">info:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  title: &quot;gcp-gke-test-cluster in apollo-playground&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  version: 1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paths: {}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Apply specification:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ gcloud endpoints --project apollo-playground --account &quot;user@gmail.com services deploy ./dns-openapi.yaml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Waiting for async operation operations/serviceConfigs.gcp-gke-test-cluster.endpoints.apollo-playground.cloud.goog:1bac952f-0216-4694-bf89-44ebe3e56c0b to complete...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Operation finished successfully. The following command can describe the Operation details:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud endpoints operations describe operations/serviceConfigs.gcp-gke-test-cluster.endpoints.apollo-playground.cloud.goog:1bac952f-0216-4694-bf89-44ebe3e56c0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Waiting for async operation operations/rollouts.gcp-gke-test-cluster.endpoints.apollo-playground.cloud.goog:4934d786-8527-42cc-bc46-77642d7d9f44 to complete...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Operation finished successfully. The following command can describe the Operation details:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud endpoints operations describe operations/rollouts.gcp-gke-test-cluster.endpoints.apollo-playground.cloud.goog:4934d786-8527-42cc-bc46-77642d7d9f44</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Service Configuration [2021-12-10r0] uploaded for service [gcp-gke-test-cluster.endpoints.apollo-playground.cloud.goog]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To manage your API, go to: https://console.cloud.google.com/endpoints/api/gcp-gke-test-cluster.endpoints.apollo-playground.cloud.goog/overview?project=apollo-playground</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After creation check the GCP console:
<img alt="gke-endpoints" src="/xl-deploy-kubernetes-operator/assets/images/gke-endpoints-8c5b457aa16cbf0810c8206276d35727.png"></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="delete-the-cluster">Delete the cluster<a aria-hidden="true" class="hash-link" href="#delete-the-cluster" title="Direct link to heading">​</a></h2><p>Clean up your unnecessary resources, use the az group delete command to remove the resource group, container service, and all related resources.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ gcloud beta container --account </span><span class="token string" style="color:#e3116c">&quot;user@gmail.com&quot;</span><span class="token plain"> --project </span><span class="token string" style="color:#e3116c">&quot;apollo-playground&quot;</span><span class="token plain"> clusters delete </span><span class="token string" style="color:#e3116c">&quot;gcp-gke-test-cluster&quot;</span><span class="token plain"> --zone </span><span class="token string" style="color:#e3116c">&quot;us-central1-a&quot;</span><span class="token plain"> --quiet</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Clean up DNS service on Google&#x27;s endpoints service:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ gcloud endpoints --project apollo-playground  services delete </span><span class="token string" style="color:#e3116c">&quot;gcp-gke-test-cluster.endpoints.apollo-playground.cloud.goog&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/xl-deploy-kubernetes-operator/docs/manual/azure-aks"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->Azure AKS</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/xl-deploy-kubernetes-operator/docs/manual/updating-configuration-files"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Updating configuration files on Deploy<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#create-the-cluster" class="table-of-contents__link toc-highlight">Create the cluster</a></li><li><a href="#storage-class" class="table-of-contents__link toc-highlight">Storage class</a><ul><li><a href="#compute-engine-persistent-disk-csi-driver" class="table-of-contents__link toc-highlight">Compute Engine persistent disk CSI Driver</a></li></ul></li><li><a href="#start-operator" class="table-of-contents__link toc-highlight">Start operator</a><ul><li><a href="#troubleshouting" class="table-of-contents__link toc-highlight">Troubleshouting</a></li></ul></li><li><a href="#setting-up-google-cloud-endpoints-to-use-googles-dns" class="table-of-contents__link toc-highlight">Setting up Google Cloud Endpoints to use Google&#39;s DNS</a></li><li><a href="#delete-the-cluster" class="table-of-contents__link toc-highlight">Delete the cluster</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/xl-deploy-kubernetes-operator/docs/intro">Tutorial</a></li><li class="footer__item"><a href="https://github.com/xebialabs/xl-deploy-kubernetes-operator" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Deploy Kubernetes Operator Digital.ai</div></div></div></footer></div>
<script src="/xl-deploy-kubernetes-operator/assets/js/runtime~main.a891f62a.js"></script>
<script src="/xl-deploy-kubernetes-operator/assets/js/main.c3b13f3d.js"></script>
</body>
</html>