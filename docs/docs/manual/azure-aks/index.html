<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<title data-react-helmet="true">Azure AKS | Deploy Kubernetes Operator</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/azure-aks"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Azure AKS | Deploy Kubernetes Operator"><meta data-react-helmet="true" name="description" content="Here it will be described how to install manually Deploy k8s cluster with help of operator to Azure."><meta data-react-helmet="true" property="og:description" content="Here it will be described how to install manually Deploy k8s cluster with help of operator to Azure."><link data-react-helmet="true" rel="shortcut icon" href="/xl-deploy-kubernetes-operator/img/digital_ai_deploy.svg"><link data-react-helmet="true" rel="canonical" href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/azure-aks"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/azure-aks" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/azure-aks" hreflang="x-default"><link rel="stylesheet" href="/xl-deploy-kubernetes-operator/assets/css/styles.22a8eaea.css">
<link rel="preload" href="/xl-deploy-kubernetes-operator/assets/js/runtime~main.8a86a8b4.js" as="script">
<link rel="preload" href="/xl-deploy-kubernetes-operator/assets/js/main.a47fa1c3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/xl-deploy-kubernetes-operator/"><div class="navbar__logo"><img src="/xl-deploy-kubernetes-operator/img/digital_ai_deploy.svg" alt="Deploy Kubernetes Operator Digital.ai" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/xl-deploy-kubernetes-operator/img/digital_ai_deploy.svg" alt="Deploy Kubernetes Operator Digital.ai" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Deploy Kubernetes Operator</b></a><a class="navbar__item navbar__link navbar__link--active" href="/xl-deploy-kubernetes-operator/docs/intro">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/xebialabs/xl-deploy-kubernetes-operator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">üåú</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">üåû</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-operator/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-operator/docs/scaffolding">Scaffolding</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Manual installation</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/onprem">On Premises</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/openshift">AWS OpenShift</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/aws-eks">AWS EKS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/azure-aks">Azure AKS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/gcp-gke">Google Cloud Platform GKE</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Azure AKS</h1></header><p>Here it will be described how to install manually Deploy k8s cluster with help of operator to Azure.</p><ul><li>You should install <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli" target="_blank" rel="noopener noreferrer">Azure CLI locally</a></li><li>Use kubernetes walkthrough, in the next section with <code>az</code> to setup k8s cluster. Here are more detailed description: <a href="https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough" target="_blank" rel="noopener noreferrer">Deploy an Azure Kubernetes Service cluster using the Azure CLI</a> as alternative use <a href="https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough-portal" target="_blank" rel="noopener noreferrer">GUI alternative</a><ul><li>Check first Prerequisites to <a href="https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli" target="_blank" rel="noopener noreferrer">Sign in with Azure CLI</a></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="create-the-cluster">Create the cluster<a aria-hidden="true" class="hash-link" href="#create-the-cluster" title="Direct link to heading">‚Äã</a></h2><p>Here are basic steps to setup k8s cluster.</p><p>Create a resource group</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ az group create --name xld-operator-group --location germanywestcentral</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/subscriptions/.../resourceGroups/xld-operator-group&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;location&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;germanywestcentral&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;managedBy&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;xld-operator-group&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;properties&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;provisioningState&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Succeeded&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;tags&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Microsoft.Resources/resourceGroups&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Create new TLS private key (in other way it is using default key from SSL config)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen -f ssh-key-xld-operator-cluster -N </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"> -m pem</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This will create new private and public key files. We will use public file <code>ssh-key-xld-operator-cluster.pub</code> in the next step.   </p><h3 class="anchor anchorWithStickyNavbar_31ik" id="create-an-aks-cluster">Create an AKS cluster<a aria-hidden="true" class="hash-link" href="#create-an-aks-cluster" title="Direct link to heading">‚Äã</a></h3><p>Check available k8s versions, if default one is 1.20.x it is OK,
in other case in next step during cluster creation use option <code>--kubernetes-version</code> with available 1.20.x version as value:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">az aks get-versions --location germanywestcentral</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Create an AKS cluster </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ az aks create --resource-group xld-operator-group  --name xld-operator-cluster --node-count </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> --enable-addons monitoring --ssh-key-value ssh-key-xld-operator-cluster.pub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAD role propagation done</span><span class="token punctuation" style="color:#393A34">[</span><span class="token comment" style="color:#999988;font-style:italic">############################################]  100.0000%{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;aadProfile&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;sku&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Basic&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;tier&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Free&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;tags&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Microsoft.ContainerService/ManagedClusters&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;windowsProfile&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>If you need to scale number of replicas 1 default node will not be enough (default node-vm-size is <code>Standard_DS2_v2</code> with 7GiB and 2vCPU),
so use <code>--node-count 2</code> or <code>--node-vm-size Standard_DS3_v2</code> with 14GiB and 4vCPU.</p></div></div><p>Result on the Azure Portal dashboard:
<img alt="aks-xld-operator-cluster" src="/xl-deploy-kubernetes-operator/assets/images/aks-xld-operator-cluster-6f65ec20c609fcf6b5a99406692e37d0.png"></p><p>Connect to the cluster</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ az aks get-credentials --resource-group xld-operator-group --name xld-operator-cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Merged </span><span class="token string" style="color:#e3116c">&quot;xld-operator-cluster&quot;</span><span class="token plain"> as current context </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> /Users/vpugar/.kube/config</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Check if your cluster is fully functional</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ kubectl get node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                STATUS   ROLES   AGE     VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aks-nodepool1-32131366-vmss000000   Ready    agent   6h36m   v1.20.9</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can take now the keys and URL and update <code>deploy-operator-azure-aks/digitalai-deploy/infrastructure.yaml</code>. Following are mappings:</p><table><thead><tr><th align="center">Field name</th><th align="center">Path to the cert</th></tr></thead><tbody><tr><td align="center">apiServerURL</td><td align="center">~/.kube/config:clusters<!-- -->[<!-- -->name=xld-operator-cluster<!-- -->]<!-- -->.cluster.server</td></tr><tr><td align="center">caCert</td><td align="center">~/.kube/config:clusters<!-- -->[<!-- -->name=xld-operator-cluster<!-- -->]<!-- -->.cluster.certificate-authority-data</td></tr><tr><td align="center">tlsCert</td><td align="center">~/.kube/config:users<!-- -->[<!-- -->name=clusterUser_xld-operator-group_xld-operator-cluster<!-- -->]<!-- -->.user.client-certificate-data</td></tr><tr><td align="center">tlsPrivateKey</td><td align="center">~/.kube/config:users<!-- -->[<!-- -->name=clusterUser_xld-operator-group_xld-operator-cluster<!-- -->]<!-- -->.user.client-key-data</td></tr></tbody></table><p>You can use base64 encoded values from the <code>~/.kube/config</code>, as is, in that case, from the <code>infrastructure.yaml</code>, just remove header/footer lines with <code>-----</code> that under that specific key value that you are replacing.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="storage-class">Storage class<a aria-hidden="true" class="hash-link" href="#storage-class" title="Direct link to heading">‚Äã</a></h2><p>Get default storage class</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ kubectl get storageclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                PROVISIONER                RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azurefile           kubernetes.io/azure-file   Delete          Immediate              </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                   6h36m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azurefile-premium   kubernetes.io/azure-file   Delete          Immediate              </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                   6h36m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   kubernetes.io/azure-disk   Delete          WaitForFirstConsumer   </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                   6h36m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">managed-premium     kubernetes.io/azure-disk   Delete          WaitForFirstConsumer   </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                   6h36m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>It should be used <code>default</code>, so update all occurrences of storageClass in the <code>xld_v1alpha_digitaldeploy.yaml</code> to <code>default</code> value.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="azure-files-dynamic">Azure Files Dynamic<a aria-hidden="true" class="hash-link" href="#azure-files-dynamic" title="Direct link to heading">‚Äã</a></h3><p>storageClass <code>default</code> is not good enough for the database setup and other shared folders&#x27; requirement, so in that case
there are multiple ways to create shared data-volumes, here are options:</p><ul><li><a href="https://docs.microsoft.com/en-us/azure/aks/azure-disks-dynamic-pv" target="_blank" rel="noopener noreferrer">Azure Disk Dynamic</a> (can be used by only one node)</li><li><a href="https://docs.microsoft.com/en-us/azure/aks/azure-files-dynamic-pv" target="_blank" rel="noopener noreferrer">Azure Files Dynamic</a> </li><li><a href="https://docs.microsoft.com/en-us/azure/aks/azure-files-volume" target="_blank" rel="noopener noreferrer">Azure Files Static</a> </li><li><a href="https://docs.microsoft.com/en-us/azure/aks/azure-nfs-volume" target="_blank" rel="noopener noreferrer">NFS server Static</a> (NFS Server onto a Virtual Machine)</li><li>and others, see <a href="https://docs.microsoft.com/en-us/azure/aks/concepts-storage" target="_blank" rel="noopener noreferrer">Storage options for applications in Azure Kubernetes Service (AKS)</a></li></ul><p><strong>Following was tested with Azure Files and Disk Dynamic</strong></p><p>Create a file named <code>azure-file-sc.yaml</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> xld</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">operator</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">azurefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">provisioner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubernetes.io/azure</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">mountOptions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> dir_mode=0777</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> file_mode=0777</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> uid=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> gid=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mfsymlinks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cache=strict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> actimeo=30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">skuName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Standard_LRS</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Using Standard_LRS - standard locally redundant storage (LRS).</p><p>Apply it</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ kubectl apply -f azure-file-sc.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storageclass.storage.k8s.io/xld-operator-azurefile created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>xld-operator-azurefile</code> storage class must be marked only the default annotation so that PersistentVolumeClaim objects (without a StorageClass specified) will trigger dynamic provisioning.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ kubectl patch storageclass xld-operator-azurefile -p </span><span class="token string" style="color:#e3116c">&#x27;{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storageclass.storage.k8s.io/xld-operator-azurefile patched</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ kubectl patch storageclass default -p </span><span class="token string" style="color:#e3116c">&#x27;{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;false&quot;}}}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storageclass.storage.k8s.io/default patched</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Previous setup <code>xld-operator-azurefile</code> will not work correctly with PostgreSQL. This is because PostgreSQL requires hard links in the Azure File directory, and since Azure File does not support hard links the pod fails to start.
So we need additional storageClass with Azure disk. Create a file named <code>azure-disk-sc.yaml</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> xld</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">operator</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">azuredisk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">provisioner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubernetes.io/azure</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">reclaimPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Delete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">volumeBindingMode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> WaitForFirstConsumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">storageaccounttype</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Standard_LRS</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Apply it</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ kubectl apply -f azure-disk-sc.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storageclass.storage.k8s.io/xld-operator-azuredisk created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Check storage class, it should be something like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ kubectl get storageclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                               PROVISIONER                RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azurefile                          kubernetes.io/azure-file   Delete          Immediate              </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                   49m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azurefile-premium                  kubernetes.io/azure-file   Delete          Immediate              </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                   49m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default                            kubernetes.io/azure-disk   Delete          WaitForFirstConsumer   </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                   49m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">managed-premium                    kubernetes.io/azure-disk   Delete          WaitForFirstConsumer   </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                   49m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xld-operator-azuredisk             kubernetes.io/azure-disk   Delete          WaitForFirstConsumer   </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain">                  4m56s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xld-operator-azurefile </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   kubernetes.io/azure-file   Delete          Immediate              </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain">                  29m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>It should be used now as storageClass <code>xld-operator-azurefile</code>.
So update all occurrences of storageClass in the <code>xld_v1alpha_digitaldeploy.yaml</code> to <code>xld-operator-azurefile</code> value,
except one under </p><ul><li><code>spec.postgresql.common.global.storageClass</code></li><li><code>spec.postgresql.global.storageClass</code></li><li><code>spec.postgresql.persitence.storageClass</code></li></ul><p>there should be <code>xld-operator-azuredisk</code>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="setting-up-azure-dns">Setting up Azure DNS<a aria-hidden="true" class="hash-link" href="#setting-up-azure-dns" title="Direct link to heading">‚Äã</a></h2><p>Here we will setup Azure DNS. For setting up details check <a href="https://docs.microsoft.com/en-us/azure/aks/static-ip#apply-a-dns-label-to-the-service" target="_blank" rel="noopener noreferrer">Apply a DNS label to the service</a>.</p><p>The final URL will be in the following example: <a href="http://xld-operator123.germanywestcentral.cloudapp.azure.com/xl-deploy/#/explorer" target="_blank" rel="noopener noreferrer">http://xld-operator123.germanywestcentral.cloudapp.azure.com/xl-deploy/#/explorer</a></p><p>Update <code>xld_v1alpha_digitaldeploy.yaml</code> on following places:</p><ul><li><code>spec.ingress.hosts</code> update first element to <code>xld-operator123.germanywestcentral.cloudapp.azure.com</code></li><li><code>spec.nginx-ingress-controller.service.annotations</code> add annotation: <code>service.beta.kubernetes.io/azure-dns-label-name: xld-operator123</code></li></ul><p>After successful startup of the operator, check following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ kubectl get ing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                      CLASS    HOSTS                                                   ADDRESS   PORTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">digitalaideploy-sample-digitalai-deploy   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   xld-operator123.germanywestcentral.cloudapp.azure.com             </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">      15m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>and (here check for the events, events need to be both here):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ kubectl describe </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> digitalaideploy-sample-nginx-ingress-controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name:                     digitalaideploy-sample-nginx-ingress-controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Namespace:                default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Labels:                   app.kubernetes.io/component</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          app.kubernetes.io/instance</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">digitalaideploy-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          app.kubernetes.io/managed-by</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Helm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          app.kubernetes.io/name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nginx-ingress-controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          helm.sh/chart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nginx-ingress-controller-7.4.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Annotations:              meta.helm.sh/release-name: digitalaideploy-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          meta.helm.sh/release-namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          service.beta.kubernetes.io/azure-dns-label-name: xld-operator123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Selector:                 app.kubernetes.io/component</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">controller,app.kubernetes.io/instance</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">digitalaideploy-sample,app.kubernetes.io/name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nginx-ingress-controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type:                     LoadBalancer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IP Families:              </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IP:                       </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.212.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPs:                      </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.212.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LoadBalancer Ingress:     </span><span class="token number" style="color:#36acaa">20.79</span><span class="token plain">.230.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Port:                     http  </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">/TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TargetPort:               http/TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NodePort:                 http  </span><span class="token number" style="color:#36acaa">30834</span><span class="token plain">/TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Endpoints:                </span><span class="token number" style="color:#36acaa">10.244</span><span class="token plain">.1.10:80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Port:                     https  </span><span class="token number" style="color:#36acaa">443</span><span class="token plain">/TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TargetPort:               https/TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NodePort:                 https  </span><span class="token number" style="color:#36acaa">31593</span><span class="token plain">/TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Endpoints:                </span><span class="token number" style="color:#36acaa">10.244</span><span class="token plain">.1.10:443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session Affinity:         None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">External Traffic Policy:  Cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Events:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Type    Reason                Age   From                Message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ----    ------                ----  ----                -------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  EnsuringLoadBalancer  16m   service-controller  Ensuring load balancer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  EnsuredLoadBalancer   16m   service-controller  Ensured load balancer</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="start-operator">Start operator<a aria-hidden="true" class="hash-link" href="#start-operator" title="Direct link to heading">‚Äã</a></h2><p>Run following command</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">xl apply -v -f digital-ai.yaml </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Check services in shell:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ kubectl get services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                              TYPE           CLUSTER-IP     EXTERNAL-IP   PORT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">S</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                                 AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">controller-manager-metrics-service                                ClusterIP      </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.104.207   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">8443</span><span class="token plain">/TCP                                4m37s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">digitalaideploy-sample-digitalai-deploy-lb                        ClusterIP      </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.243.11    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">4516</span><span class="token plain">/TCP                                3m25s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">digitalaideploy-sample-digitalai-deploy-master                    ClusterIP      None           </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">8180</span><span class="token plain">/TCP                                3m25s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">digitalaideploy-sample-digitalai-deploy-worker                    ClusterIP      None           </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">8180</span><span class="token plain">/TCP                                3m25s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">digitalaideploy-sample-nginx-ingress-controller                   LoadBalancer   </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.212.10    </span><span class="token number" style="color:#36acaa">20.79</span><span class="token plain">.230.4   </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">:30834/TCP,443:31593/TCP              3m25s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">digitalaideploy-sample-nginx-ingress-controller-default-backend   ClusterIP      </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.104.158   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">/TCP                                  3m25s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">digitalaideploy-sample-postgresql                                 ClusterIP      </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.15.27     </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">5432</span><span class="token plain">/TCP                                3m25s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">digitalaideploy-sample-postgresql-headless                        ClusterIP      None           </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">5432</span><span class="token plain">/TCP                                3m25s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">digitalaideploy-sample-rabbitmq                                   ClusterIP      </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.31.132    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">5672</span><span class="token plain">/TCP,4369/TCP,25672/TCP,15672/TCP   3m25s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">digitalaideploy-sample-rabbitmq-headless                          ClusterIP      None           </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">4369</span><span class="token plain">/TCP,5672/TCP,25672/TCP,15672/TCP   3m25s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubernetes                                                        ClusterIP      </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.0.1       </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">443</span><span class="token plain">/TCP                                 3h3m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The final result on Azure Portal, all should be running (running all with 1 replica) with list of pods and services :
<img alt="aks-pods" src="/xl-deploy-kubernetes-operator/assets/images/aks-pods-7a99bb313aadb7c4e265e463698033d3.png">
<img alt="aks-services" src="/xl-deploy-kubernetes-operator/assets/images/aks-services-a2e5d51614b63f661cb467afd5cdacb4.png"></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="troubleshouting">Troubleshouting<a aria-hidden="true" class="hash-link" href="#troubleshouting" title="Direct link to heading">‚Äã</a></h3><p>There are possible problems during deployment:</p><ul><li>if deployment fails because not matching namespace, just remove nemaspeace from the yaml file <ul><li>for example during <code>Create Service controller-manager-metrics-service</code>. Just remove namespace from the xld-operator-setup/config/rbac/auth-proxy-service.yaml</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="delete-the-cluster">Delete the cluster<a aria-hidden="true" class="hash-link" href="#delete-the-cluster" title="Direct link to heading">‚Äã</a></h2><p>Clean up your unnecessary resources, use the az group delete command to remove the resource group, container service, and all related resources.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">‚ùØ az group delete --name xld-operator-group --yes --no-wait</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/xl-deploy-kubernetes-operator/docs/manual/aws-eks"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ <!-- -->AWS EKS</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/xl-deploy-kubernetes-operator/docs/manual/gcp-gke"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Google Cloud Platform GKE<!-- --> ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#create-the-cluster" class="table-of-contents__link toc-highlight">Create the cluster</a><ul><li><a href="#create-an-aks-cluster" class="table-of-contents__link toc-highlight">Create an AKS cluster</a></li></ul></li><li><a href="#storage-class" class="table-of-contents__link toc-highlight">Storage class</a><ul><li><a href="#azure-files-dynamic" class="table-of-contents__link toc-highlight">Azure Files Dynamic</a></li></ul></li><li><a href="#setting-up-azure-dns" class="table-of-contents__link toc-highlight">Setting up Azure DNS</a></li><li><a href="#start-operator" class="table-of-contents__link toc-highlight">Start operator</a><ul><li><a href="#troubleshouting" class="table-of-contents__link toc-highlight">Troubleshouting</a></li></ul></li><li><a href="#delete-the-cluster" class="table-of-contents__link toc-highlight">Delete the cluster</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/xl-deploy-kubernetes-operator/docs/intro">Tutorial</a></li><li class="footer__item"><a href="https://github.com/xebialabs/xl-deploy-kubernetes-operator" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Deploy Kubernetes Operator Digital.ai</div></div></div></footer></div>
<script src="/xl-deploy-kubernetes-operator/assets/js/runtime~main.8a86a8b4.js"></script>
<script src="/xl-deploy-kubernetes-operator/assets/js/main.a47fa1c3.js"></script>
</body>
</html>