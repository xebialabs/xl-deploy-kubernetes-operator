<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<title data-react-helmet="true">manual-upgrade-for-xld-10 | Deploy Kubernetes Operator</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/manual-upgrade-for-xld-10"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="manual-upgrade-for-xld-10 | Deploy Kubernetes Operator"><meta data-react-helmet="true" name="description" content="This is internal documentation. This document can be used only if it was recommended by the Support Team."><meta data-react-helmet="true" property="og:description" content="This is internal documentation. This document can be used only if it was recommended by the Support Team."><link data-react-helmet="true" rel="shortcut icon" href="/xl-deploy-kubernetes-operator/img/digital_ai_deploy.svg"><link data-react-helmet="true" rel="canonical" href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/manual-upgrade-for-xld-10"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/manual-upgrade-for-xld-10" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/manual-upgrade-for-xld-10" hreflang="x-default"><link rel="stylesheet" href="/xl-deploy-kubernetes-operator/assets/css/styles.22a8eaea.css">
<link rel="preload" href="/xl-deploy-kubernetes-operator/assets/js/runtime~main.52d18a38.js" as="script">
<link rel="preload" href="/xl-deploy-kubernetes-operator/assets/js/main.379efe97.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/xl-deploy-kubernetes-operator/"><div class="navbar__logo"><img src="/xl-deploy-kubernetes-operator/img/digital_ai_deploy.svg" alt="Deploy Kubernetes Operator Digital.ai" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/xl-deploy-kubernetes-operator/img/digital_ai_deploy.svg" alt="Deploy Kubernetes Operator Digital.ai" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Deploy Kubernetes Operator</b></a><a class="navbar__item navbar__link navbar__link--active" href="/xl-deploy-kubernetes-operator/docs/intro">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/xebialabs/xl-deploy-kubernetes-operator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-operator/docs/intro">intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Manual installation</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/onprem">onprem</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/openshift">openshift</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/aws-eks">aws-eks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/azure-aks">azure-aks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/gcp-gke">gcp-gke</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/setting-up-custom-namespace">setting-up-custom-namespace</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/change-namespace-for-xld-10.3-with-parallel">change-namespace-for-xld-10.3-with-parallel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/change-namespace-for-xld-10.3-with-downtime">change-namespace-for-xld-10.3-with-downtime</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/move_pvc_to_other_namespace">move_pvc_to_other_namespace</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/manual-upgrade-for-xld-10">manual-upgrade-for-xld-10</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>manual-upgrade-for-xld-10</h1></header><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>This is internal documentation. This document can be used only if it was recommended by the Support Team.</p></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>This setup is deprecated from the 22.3 version.</p></div></div><header><h1>Manual helm to operator upgrade of xld from version 10 to above 22.1 version.</h1></header><h2 class="anchor anchorWithStickyNavbar_31ik" id="prerequisites">Prerequisites<a aria-hidden="true" class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h2><ul><li>The kubectl command-line tool</li><li>Access to a Kubernetes cluster with installed Deploy in the <code>default</code> namespace</li></ul><p>Tested with:</p><ul><li>Deploy helm based installer version 10.0.0 with external database.</li><li>xl-deploy 10.0 upgraded to 22.1.4 with keycloak disabled.</li><li>xl-cli 22.1.4</li><li>Aws EKS cluster.</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="1-backup-everything">1. Backup everything<a aria-hidden="true" class="hash-link" href="#1-backup-everything" title="Direct link to heading">​</a></h2><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Before doing any of the following steps backup everything:</p><ul><li><p><a href="https://docs.xebialabs.com/v.22.1/deploy/concept/the-xl-deploy-work-directory/#clean-up-the-work-directory" target="_blank" rel="noopener noreferrer">Clean up deploy Work directory</a></p></li><li><p>database data</p></li><li><p>any custom configuration that was done for the operator setup</p><ul><li>StatefulSets</li><li>Deployments</li><li>ConfigMaps</li><li>Secrets</li><li>CustomResource</li><li>anything else that was customized</li></ul></li><li><p>any volume related to deploy master in the default namespace, for example data from the mounted volumes on deploy master pod:</p><ul><li>/opt/xebialabs/xl-deploy-server/export</li></ul></li><li><p>any volume related to deploy worker in the default namespace, for example data from the mounted volumes on deploy worker pod:</p><ul><li>/opt/xebialabs/xl-deploy-server/work   </li></ul></li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="2-be-sure-to-not-delete-pvs-with-your-actions-and-update-pv--reclaim-policy-to-retain">2. Be sure to not delete PVs with your actions and update PV  RECLAIM POLICY To Retain<a aria-hidden="true" class="hash-link" href="#2-be-sure-to-not-delete-pvs-with-your-actions-and-update-pv--reclaim-policy-to-retain" title="Direct link to heading">​</a></h2><p>Patch the all PVs to set the “persistentVolumeReclaimPolicy” to “Retain”, for example (if cluster admin&#x27;s didn&#x27;t do that already):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get </span><span class="token function" style="color:#d73a49">pv</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                                       STORAGECLASS          REASON   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-0e0a6bcd-77e3-4002-a355-2e5a74f637c4   10Gi       RWO            Delete           Bound    default/xld-production-digitalai-deploy                     aws-efs-provisioner            9s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-5728a562-69a3-4fdd-90f8-b5316f7460a0   8Gi        RWO            Delete           Bound    default/data-xld-production-rabbitmq-0                      aws-efs-provisioner            7s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-ef01748d-1d1a-46bf-8e0f-e946a8274b56   5Gi        RWO            Delete           Bound    default/work-dir-xld-production-digitalai-deploy-worker-0   aws-efs-provisioner            7s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl patch </span><span class="token function" style="color:#d73a49">pv</span><span class="token plain"> pvc-0e0a6bcd-77e3-4002-a355-2e5a74f637c4 -p </span><span class="token string" style="color:#e3116c">&#x27;{&quot;spec&quot;:{&quot;persistentVolumeReclaimPolicy&quot;:&quot;Retain&quot;}}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolume/pvc-0e0a6bcd-77e3-4002-a355-2e5a74f637c4 patched</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Export the current PVCs objects because it will be necessary to recreate the PVCs in a later stage:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get pvc xld-production-digitalai-deploy -n default -o yaml </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> pvc-xld-production-digitalai-deploy.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get pvc work-dir-xld-production-digitalai-deploy-worker-0 -n default -o yaml </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> pvc-work-dir-xld-production-digitalai-deploy-worker-0.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Iterate on all PVs that are connected to the XLD PVCs in the default namespace, list depends on the installed components.
For example, here is list of PVCs that are usually in the default namespace:</p><ul><li>xld-production-digitalai-deploy</li><li>work-dir-xld-production-digitalai-deploy-worker-0</li><li>data-xld-production-postgresql-0 -- if we are using embedded database</li><li>data-xld-production-rabbitmq-0</li></ul><p>On the end check if all PVs have correct Reclaim Policy:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get </span><span class="token function" style="color:#d73a49">pv</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                                       STORAGECLASS          REASON   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-0e0a6bcd-77e3-4002-a355-2e5a74f637c4   10Gi       RWO            Retain           Bound    default/xld-production-digitalai-deploy                     aws-efs-provisioner            2m37s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-5728a562-69a3-4fdd-90f8-b5316f7460a0   8Gi        RWO            Retain           Bound    default/data-xld-production-rabbitmq-0                      aws-efs-provisioner            2m35s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-ef01748d-1d1a-46bf-8e0f-e946a8274b56   5Gi        RWO            Retain           Bound    default/work-dir-xld-production-digitalai-deploy-worker-0   aws-efs-provisioner            2m35s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="3-creating-new-pvc-for-dai-deploy-master-by-copying-pv-data">3. Creating new PVC for dai-deploy master by copying PV data.<a aria-hidden="true" class="hash-link" href="#3-creating-new-pvc-for-dai-deploy-master-by-copying-pv-data" title="Direct link to heading">​</a></h2><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>eg: helm release name : xld-production</p></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="i-make-the-copy-of-the-pvc-xld-production-digitalai-deployyaml-for-the-later-reference">i. Make the copy of the pvc-xld-production-digitalai-deploy.yaml for the later reference.<a aria-hidden="true" class="hash-link" href="#i-make-the-copy-of-the-pvc-xld-production-digitalai-deployyaml-for-the-later-reference" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get pvc xld-production-digitalai-deploy -o yaml </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> pvc-xld-production-digitalai-deploy.yaml.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Copy the pvc-xld-production-digitalai-deploy.yaml file  to pvc-data-dir-dai-xld-digitalai-deploy-master-0.yaml<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> pvc-xld-production-digitalai-deploy.yaml pvc-data-dir-dai-xld-digitalai-deploy-master-0.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="ii-manually-create-pvc-data-dir-dai-xld-digitalai-deploy-master-0-as-mentioned-below">ii. Manually create pvc data-dir-dai-xld-digitalai-deploy-master-0 as mentioned below.<a aria-hidden="true" class="hash-link" href="#ii-manually-create-pvc-data-dir-dai-xld-digitalai-deploy-master-0-as-mentioned-below" title="Direct link to heading">​</a></h3><ul><li>Delete all the lines under sections:<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec.volumneMode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec.volumneName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.uid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.resourceVersion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.creationTimestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.finalizers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.annotations.pv.kubernetes.io/bind-completed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.annotations.pv.kubernetes.io/bound-by-controller</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li>Update the following in yaml:<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">metadata.name from </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">release-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">-digitalai-deploy to data-dir-dai-xld-digitalai-deploy-master-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.labels.release: dai-xld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.annotations.meta.helm.sh/release-namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.annotations.meta.helm.sh/release-name </span><span class="token builtin class-name">:</span><span class="token plain"> dai-xld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.annotations:helm.sh/resource-policy: keep</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="iii--create-pvc-dai-xld-digitalai-deploy">iii.  Create PVC dai-xld-digitalai-deploy.<a aria-hidden="true" class="hash-link" href="#iii--create-pvc-dai-xld-digitalai-deploy" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl apply -f pvc-data-dir-dai-xld-digitalai-deploy-master-0.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl apply -f pvc-data-dir-dai-xld-digitalai-deploy-master-0.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolumeclaim/data-dir-dai-xld-digitalai-deploy-master-0 created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="iv-verify-if-pv-bounded">iv. Verify if PV bounded<a aria-hidden="true" class="hash-link" href="#iv-verify-if-pv-bounded" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get pvc data-dir-dai-xld-digitalai-deploy-master-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                         STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data-dir-dai-xld-digitalai-deploy-master-0   Bound    pvc-64444985-8e98-406c-984f-1d12449f039f   10Gi       RWO            aws-efs-provisioner   62s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get </span><span class="token function" style="color:#d73a49">pv</span><span class="token plain"> pvc-64444985-8e98-406c-984f-1d12449f039f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                                STORAGECLASS          REASON   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-64444985-8e98-406c-984f-1d12449f039f   10Gi       RWO            Delete           Bound    default/data-dir-dai-xld-digitalai-deploy-master-0   aws-efs-provisioner            2m54s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="v-update-the-reclaim-policy-to-retain-for-newly-created-pv-of-data-dir-dai-xld-digitalai-deploy-master-0">v. Update the Reclaim policy to Retain, for newly created pv of data-dir-dai-xld-digitalai-deploy-master-0.<a aria-hidden="true" class="hash-link" href="#v-update-the-reclaim-policy-to-retain-for-newly-created-pv-of-data-dir-dai-xld-digitalai-deploy-master-0" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl patch </span><span class="token function" style="color:#d73a49">pv</span><span class="token plain"> pvc-64444985-8e98-406c-984f-1d12449f039f -p </span><span class="token string" style="color:#e3116c">&#x27;{&quot;spec&quot;:{&quot;persistentVolumeReclaimPolicy&quot;:&quot;Retain&quot;}}&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolume/pvc-64444985-8e98-406c-984f-1d12449f039f patched</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get </span><span class="token function" style="color:#d73a49">pv</span><span class="token plain"> pvc-64444985-8e98-406c-984f-1d12449f039f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                                STORAGECLASS          REASON   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-64444985-8e98-406c-984f-1d12449f039f   10Gi       RWO            Retain           Bound    default/data-dir-dai-xld-digitalai-deploy-master-0   aws-efs-provisioner            3m54s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="vi-start-the-following-pod-for-accessing-the-newly-created-pvc-data-dir-dai-xld-digitalai-deploy-master-0">vi. Start the following pod for accessing the newly created PVC <!-- -->[data-dir-dai-xld-digitalai-deploy-master-0]<!-- -->.<a aria-hidden="true" class="hash-link" href="#vi-start-the-following-pod-for-accessing-the-newly-created-pvc-data-dir-dai-xld-digitalai-deploy-master-0" title="Direct link to heading">​</a></h3><ul><li>Update the pod <!-- -->[pod-data-dir-dai-xld-digitalai-deploy-master-0.yaml]<!-- --> yaml with exact volumes which we mounted in previous installation.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: pod-data-dir-dai-xld-digitalai-deploy-master-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: sleeper      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      command: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sleep&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;1d&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image: xebialabs/tiny-tools:22.2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      imagePullPolicy: Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - mountPath: /opt/xebialabs/xl-deploy-server/export</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: export-dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          subPath: </span><span class="token builtin class-name">export</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  restartPolicy: Never</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: export-dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      persistentVolumeClaim:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        claimName: data-dir-dai-xld-digitalai-deploy-master-0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Start the pod</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl apply -f pod-data-dir-dai-xld-digitalai-deploy-master-0.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/pod-data-dir-dai-xld-digitalai-deploy-master-0 created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get pod/pod-data-dir-dai-xld-digitalai-deploy-master-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                             READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod-data-dir-dai-xld-digitalai-deploy-master-0   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          30s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Verify the mouted path is available in newly created PV.<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -it pod/pod-data-dir-dai-xld-digitalai-deploy-master-0 -- </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/ </span><span class="token comment" style="color:#999988;font-style:italic"># cd /opt/xebialabs/xl-deploy-server/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/xebialabs/xl-deploy-server </span><span class="token comment" style="color:#999988;font-style:italic"># ls -lrt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxrws--x </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> root </span><span class="token number" style="color:#36acaa">40136</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6144</span><span class="token plain"> Jun </span><span class="token number" style="color:#36acaa">28</span><span class="token plain"> 09:55 </span><span class="token builtin class-name">export</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/xebialabs/xl-deploy-server </span><span class="token comment" style="color:#999988;font-style:italic">#</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="vii-copy-data-and-give-persmission">vii. Copy data and Give Persmission.<a aria-hidden="true" class="hash-link" href="#vii-copy-data-and-give-persmission" title="Direct link to heading">​</a></h3><ul><li>Copy data from xld-production-digitalai-deploy-master-0 to pod-data-dir-dai-xld-digitalai-deploy-master-0</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -n default xld-production-digitalai-deploy-master-0 -- </span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> cf - /opt/xebialabs/xl-deploy-server/export </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -n default -i pod-data-dir-dai-xld-digitalai-deploy-master-0 -- </span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> xvf - -C /</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">eg:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -n default xld-production-digitalai-deploy-master-0 -- </span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> cf - /opt/xebialabs/xl-deploy-server/export </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -n default -i pod-data-dir-dai-xld-digitalai-deploy-master-0 -- </span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> xvf - -C /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Defaulted container </span><span class="token string" style="color:#e3116c">&quot;digitalai-deploy&quot;</span><span class="token plain"> out of: digitalai-deploy, fix-the-volume-permission </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">init</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar: Removing leading `/&#x27; from member names</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">opt/xebialabs/xl-deploy-server/export/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">opt/xebialabs/xl-deploy-server/export/test.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">opt/xebialabs/xl-deploy-server/export/content-types/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>  With the Latest version 22.1.4 we are not volume mounting the /opt/xebialabs/xl-deploy-server/export folder, if required , we need to do it manually by editing the statefulset of master pod.
and add the mount path</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl edit statefulset.apps/dai-xld-digitalai-deploy-master</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /opt/xebialabs/xl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deploy</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server/export</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">subPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> export</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><ul><li>Give full Permission to the copied data in new PV.<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -n default -i pod-data-dir-dai-xld-digitalai-deploy-master-0 -- </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> -R </span><span class="token number" style="color:#36acaa">777</span><span class="token plain"> /opt/xebialabs/xl-deploy-server/export</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><blockquote><p>kubectl exec -it -n default pod-data-dir-dai-xld-digitalai-deploy-master-0 -- sh
/ # cd /opt/xebialabs/xl-deploy-server/
/opt/xebialabs/xl-deploy-server # ls -lrt
total 4
drwxrwsrwx 3 10001 40133 6144 Jun 28 10:00 export
/opt/xebialabs/xl-deploy-server # </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></blockquote><h3 class="anchor anchorWithStickyNavbar_31ik" id="viii--delete-the-pod">viii.  Delete the pod.<a aria-hidden="true" class="hash-link" href="#viii--delete-the-pod" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl delete pod/pod-data-dir-dai-xld-digitalai-deploy-master-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod </span><span class="token string" style="color:#e3116c">&quot;pod-data-dir-dai-xld-digitalai-deploy-master-0&quot;</span><span class="token plain"> deleted</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="4-creating-new-pvc-for-dai-deploy-worker-by-copying-pv-data">4. Creating new PVC for dai-deploy worker by copying PV data.<a aria-hidden="true" class="hash-link" href="#4-creating-new-pvc-for-dai-deploy-worker-by-copying-pv-data" title="Direct link to heading">​</a></h2><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>eg: helm release name : xld-production</p></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="i-make-the-copy-of-the-pvc-work-dir-xld-production-digitalai-deploy-worker-0yaml-for-the-later-reference">i. Make the copy of the pvc-work-dir-xld-production-digitalai-deploy-worker-0.yaml for the later reference.<a aria-hidden="true" class="hash-link" href="#i-make-the-copy-of-the-pvc-work-dir-xld-production-digitalai-deploy-worker-0yaml-for-the-later-reference" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get pvc work-dir-xld-production-digitalai-deploy-worker-0 -o yaml </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> pvc-work-dir-xld-production-digitalai-deploy-worker-0.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Copy the pvc-work-dir-xld-production-digitalai-deploy-worker-0.yaml file  to pvc-data-dir-dai-xld-digitalai-deploy-worker-0.yaml<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> pvc-work-dir-xld-production-digitalai-deploy-worker-0.yaml pvc-data-dir-dai-xld-digitalai-deploy-worker-0.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="ii-manually-create-pvc-data-dir-dai-xld-digitalai-deploy-worker-0-as-mentioned-below">ii. Manually create pvc data-dir-dai-xld-digitalai-deploy-worker-0 as mentioned below.<a aria-hidden="true" class="hash-link" href="#ii-manually-create-pvc-data-dir-dai-xld-digitalai-deploy-worker-0-as-mentioned-below" title="Direct link to heading">​</a></h3><ul><li>Delete all the lines under sections:<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec.volumneMode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec.volumneName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.uid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.resourceVersion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.creationTimestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.finalizers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.annotations.pv.kubernetes.io/bind-completed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.annotations.pv.kubernetes.io/bound-by-controller</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li>Update the following in yaml:<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">metadata.name from work-dir-</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">release-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">-digitalai-deploy-worker-0 to data-dir-dai-xld-digitalai-deploy-worker-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.labels.release: dai-xld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.annotations.meta.helm.sh/release-namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.annotations.meta.helm.sh/release-name </span><span class="token builtin class-name">:</span><span class="token plain"> dai-xld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.annotations:helm.sh/resource-policy: keep</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="iii--create-pvc-dai-xld-digitalai-deploy-1">iii.  Create PVC dai-xld-digitalai-deploy.<a aria-hidden="true" class="hash-link" href="#iii--create-pvc-dai-xld-digitalai-deploy-1" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl apply -f pvc-data-dir-dai-xld-digitalai-deploy-worker-0.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl apply -f pvc-data-dir-dai-xld-digitalai-deploy-worker-0.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolumeclaim/data-dir-dai-xld-digitalai-deploy-worker-0 created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="iv-verify-if-pv-bounded-1">iv. Verify if PV bounded<a aria-hidden="true" class="hash-link" href="#iv-verify-if-pv-bounded-1" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get pvc data-dir-dai-xld-digitalai-deploy-worker-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                         STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data-dir-dai-xld-digitalai-deploy-worker-0   Bound    pvc-5ad67b27-027c-4636-b2b6-8a1e288c6251   5Gi        RWO            aws-efs-provisioner   27s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get </span><span class="token function" style="color:#d73a49">pv</span><span class="token plain"> pvc-5ad67b27-027c-4636-b2b6-8a1e288c6251</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                                STORAGECLASS          REASON   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-5ad67b27-027c-4636-b2b6-8a1e288c6251   5Gi        RWO            Delete           Bound    default/data-dir-dai-xld-digitalai-deploy-worker-0   aws-efs-provisioner            51s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="v-update-the-reclaim-policy-to-retain-for-newly-created-pv-of-data-dir-dai-xld-digitalai-deploy-worker-0">v. Update the Reclaim policy to Retain, for newly created pv of data-dir-dai-xld-digitalai-deploy-worker-0.<a aria-hidden="true" class="hash-link" href="#v-update-the-reclaim-policy-to-retain-for-newly-created-pv-of-data-dir-dai-xld-digitalai-deploy-worker-0" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl patch </span><span class="token function" style="color:#d73a49">pv</span><span class="token plain"> pvc-5ad67b27-027c-4636-b2b6-8a1e288c6251 -p </span><span class="token string" style="color:#e3116c">&#x27;{&quot;spec&quot;:{&quot;persistentVolumeReclaimPolicy&quot;:&quot;Retain&quot;}}&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolume/pvc-5ad67b27-027c-4636-b2b6-8a1e288c6251 patched</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get </span><span class="token function" style="color:#d73a49">pv</span><span class="token plain"> pvc-5ad67b27-027c-4636-b2b6-8a1e288c6251</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                               STORAGECLASS          REASON   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> pvc-dad9e7c3-ae1b-4b28-b595-4f4b281a0bf2   5Gi        RWO            Retain           Bound    default/data-dir-dai-xld-digitalai-deploy-worker-0   aws-efs-provisioner            3m40s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="vi-start-the-following-pod-for-accessing-the-newly-created-pvc-data-dir-dai-xld-digitalai-deploy-worker-0">vi. Start the following pod for accessing the newly created PVC <!-- -->[data-dir-dai-xld-digitalai-deploy-worker-0]<!-- -->.<a aria-hidden="true" class="hash-link" href="#vi-start-the-following-pod-for-accessing-the-newly-created-pvc-data-dir-dai-xld-digitalai-deploy-worker-0" title="Direct link to heading">​</a></h3><ul><li>Update the pod <!-- -->[pod-data-dir-dai-xld-digitalai-deploy-worker-0.yaml]<!-- --> yaml with exact volumes which we mounted in previous installation.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: pod-data-dir-dai-xld-digitalai-deploy-worker-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: sleeper      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      command: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sleep&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;1d&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image: xebialabs/tiny-tools:22.2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      imagePullPolicy: Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - mountPath: /opt/xebialabs/xl-deploy-server/work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: data-dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          subPath: work           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  restartPolicy: Never</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: data-dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      persistentVolumeClaim:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        claimName: data-dir-dai-xld-digitalai-deploy-worker-0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Start the pod</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl apply -f pod-data-dir-dai-xld-digitalai-deploy-worker-0.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/pod-data-dir-dai-xld-digitalai-deploy-worker-0 created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get pod/pod-data-dir-dai-xld-digitalai-deploy-worker-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                             READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod-data-dir-dai-xld-digitalai-deploy-worker-0   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          24s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Verify the mounted path is available in newly created PV.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -it pod/pod-data-dir-dai-xld-digitalai-deploy-worker-0 -- </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/ </span><span class="token comment" style="color:#999988;font-style:italic"># cd /opt/xebialabs/xl-deploy-server/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/xebialabs/xl-deploy-server </span><span class="token comment" style="color:#999988;font-style:italic"># ls -lrt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxrws--x </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> root </span><span class="token number" style="color:#36acaa">40137</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6144</span><span class="token plain"> Jun </span><span class="token number" style="color:#36acaa">28</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:01 work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/xebialabs/xl-deploy-server </span><span class="token comment" style="color:#999988;font-style:italic"># </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="vii-copy-data-and-give-persmission-1">vii. Copy data and Give Persmission.<a aria-hidden="true" class="hash-link" href="#vii-copy-data-and-give-persmission-1" title="Direct link to heading">​</a></h3><ul><li>Copy data from xld-production-digitalai-deploy-worker-0 to pod-data-dir-dai-xld-digitalai-deploy-worker-0</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -n default xld-production-digitalai-deploy-worker-0 -- </span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> cf - /opt/xebialabs/xl-deploy-server/work </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -n default -i pod-data-dir-dai-xld-digitalai-deploy-worker-0 -- </span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> xvf - -C /</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">eg:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -n default xld-production-digitalai-deploy-worker-0 -- </span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> cf - /opt/xebialabs/xl-deploy-server/work </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -n default -i pod-data-dir-dai-xld-digitalai-deploy-worker-0 -- </span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> xvf - -C /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Defaulted container </span><span class="token string" style="color:#e3116c">&quot;digitalai-deploy&quot;</span><span class="token plain"> out of: digitalai-deploy, fix-the-volume-permission </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">init</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar: Removing leading `/&#x27; from member names</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">opt/xebialabs/xl-deploy-server/work/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">opt/xebialabs/xl-deploy-server/work/task-20220628T111235796.1976/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">opt/xebialabs/xl-deploy-server/work/1d2e8d97-b433-4f92-bd56-96db8f11842c.task</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Give full Permission to the copied data in new PV.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -n default -i pod-data-dir-dai-xld-digitalai-deploy-worker-0 -- </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> -R </span><span class="token number" style="color:#36acaa">777</span><span class="token plain"> /opt/xebialabs/xl-deploy-server/work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -it -n default pod-data-dir-dai-xld-digitalai-deploy-worker-0 -- </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/ </span><span class="token comment" style="color:#999988;font-style:italic"># cd /opt/xebialabs/xl-deploy-server/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/xebialabs/xl-deploy-server </span><span class="token comment" style="color:#999988;font-style:italic"># ls -lrt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxrwsrwx </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10001</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40134</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6144</span><span class="token plain"> Jun </span><span class="token number" style="color:#36acaa">28</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:13 work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/xebialabs/xl-deploy-server </span><span class="token comment" style="color:#999988;font-style:italic">#</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="viii--delete-the-pod-1">viii.  Delete the pod.<a aria-hidden="true" class="hash-link" href="#viii--delete-the-pod-1" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl delete pod/pod-data-dir-dai-xld-digitalai-deploy-worker-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod </span><span class="token string" style="color:#e3116c">&quot;pod-data-dir-dai-xld-digitalai-deploy-worker-0&quot;</span><span class="token plain"> deleted</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="5-run-upgrade-with-dry-run-with-custom-zip-options">5. Run upgrade with dry run, with custom zip options.<a aria-hidden="true" class="hash-link" href="#5-run-upgrade-with-dry-run-with-custom-zip-options" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> xl </span><span class="token function" style="color:#d73a49">op</span><span class="token plain"> --upgrade --dry-run</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Sample output.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> .xl_22.1.4 </span><span class="token function" style="color:#d73a49">op</span><span class="token plain"> --upgrade --dry-run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Select the setup mode? advanced</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Select the Kubernetes setup where the digitalai Devops Platform will be installed or uninstalled: AwsEKS </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">AWS EKS</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Do you want to use Kubernetes&#x27; current-context from ~/.kube/config? Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Do you want to use the AWS SSO credentials ? No</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Do you want to use the AWS credentials from your ~/.aws/credentials file? Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Do you want to use an existing Kubernetes namespace? Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Enter the name of the existing Kubernetes namespace where the XebiaLabs DevOps Platform will be installed, updated or undeployed: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connecting to EKS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Product server you want to perform upgrade </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> daiDeploy </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Digital.ai Deploy</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Enter the repository name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eg: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">repositoryName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">imageName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">tagName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> xebialabs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Enter the deploy server image name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eg: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">repositoryName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">imageName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">tagName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> xl-deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Enter the image tag</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eg: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">repositoryName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">imageName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">tagName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22.1</span><span class="token plain">.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Enter the deploy task engine image name </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> version </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> and above </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eg: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">repositoryName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">imageName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">tagName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> deploy-task-engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Choose the version of the XL Deploy </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> Upgrader setup of operator </span><span class="token number" style="color:#36acaa">22.1</span><span class="token plain">.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Use embedded keycloak? No</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Select the </span><span class="token builtin class-name">type</span><span class="token plain"> of upgrade you want. helmToOperator </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Helm to Operator</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Operator image to use xebialabs/deploy-operator:22.1.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Do you want to use custom operator </span><span class="token function" style="color:#d73a49">zip</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> Deploy? Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Deploy operator </span><span class="token function" style="color:#d73a49">zip</span><span class="token plain"> to use </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">absolute path or URL to the </span><span class="token function" style="color:#d73a49">zip</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> /home/sishwarya/SprintTicket/S-84982_ns_xld_migration/helmToOperator/dryrun/deploy-operator-aws-eks-22.1.4.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Edit list of custom resource keys that will migrate to the new Deploy CR </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Received</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Enter the helm release name. xld-production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     -------------------------------- ----------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> LABEL                          </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> VALUE                                              </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     -------------------------------- ----------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> AWSAccessKey                   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> *****                                              </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> AWSAccessSecret                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> *****                                              </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> AWSSessionToken                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> *****                                              </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> DeployImageVersionForUpgrader  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22.1</span><span class="token plain">.4                                             </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> EksClusterName                 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> devops-operator-cluster-test-cluster               </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ImageNameDeploy                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> xl-deploy                                          </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ImageNameDeployTaskEngine      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> deploy-task-engine                                 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ImageTag                       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22.1</span><span class="token plain">.4                                             </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> IsAwsCfgAvailable              </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                                               </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> K8sApiServerURL                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> https://72673EC78289B3B122CAC4CA8E6473C2.gr7.us-</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> K8sSetup                       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> AwsEKS                                             </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Namespace                      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default                                            </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> OperatorImageDeployGeneric     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> xebialabs/deploy-operator:22.1.4                   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> OperatorZipDeploy              </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> /home/sishwarya/SprintTicket/S-84982_ns_xld_migr</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> OsType                         </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> linux                                              </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> PreserveCrValuesDeploy         </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> .spec.XldMasterCount</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n.spec.XldWorkerCount</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n.spe</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ReleaseName                    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> xld-production                                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> RepositoryName                 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> xebialabs                                          </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ServerType                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> daiDeploy                                          </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> UpgradeType                    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> helmToOperator                                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> UseAWSSsoCredentials           </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain">                                              </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> UseAWSconfig                   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                                               </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> UseCustomNamespace             </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                                               </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> UseEmbeddedKeycloak            </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain">                                              </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> UseKubeconfig                  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                                               </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> UseOperatorZipDeploy           </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                                               </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     -------------------------------- ----------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Do you want to proceed to the deployment with these values? Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Generated files successfully</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating original custom resource file</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.   </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"> Generated files successfully helmToOperator upgrade on AwsEKS </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="5-take-backup-of-existing-password">5. Take backup of existing password.<a aria-hidden="true" class="hash-link" href="#5-take-backup-of-existing-password" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## To get the password for postgresql, run: only when we use embedded database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get secret --namespace default xld-production-postgresql -o </span><span class="token assign-left variable" style="color:#36acaa">jsonpath</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;{.data.postgresql-password}&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> base64 --decode</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## To get the admin password for xl-deploy, run:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">kubectl get secret --namespace default xld-production-digitalai-deploy -o </span><span class="token assign-left variable" style="color:#36acaa">jsonpath</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;{.data.deploy-password}&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> base64 --decode</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## To get the password for rabbitMQ, run:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get secret xld-production-rabbitmq  -o </span><span class="token assign-left variable" style="color:#36acaa">jsonpath</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;{.data.rabbitmq-password}&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> base64 --decode</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="6-do-following-changes-in-the-xebialabsdai-deploydaideploy_cryaml-based-on-the-requirement">6. Do following changes in the xebialabs/dai-deploy/daideploy_cr.yaml, based on the requirement.<a aria-hidden="true" class="hash-link" href="#6-do-following-changes-in-the-xebialabsdai-deploydaideploy_cryaml-based-on-the-requirement" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="i-to-update-admin-password">i. To update admin password<a aria-hidden="true" class="hash-link" href="#i-to-update-admin-password" title="Direct link to heading">​</a></h3><ul><li>Default  deploy admin password is &quot;admin&quot;, if we need to update below fields.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    .spec.AdminPassword: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">password from previous installation</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="ii-if-we-are-using-external-database">ii. If we are using external database.<a aria-hidden="true" class="hash-link" href="#ii-if-we-are-using-external-database" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    .spec.UseExistingDB.enabled: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .spec.UseExistingDB.XL_DB_PASSWORD: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">db password from previous installation</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .spec.UseExistingDB.XL_DB_URL: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">db url from previous installation</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .spec.UseExistingDB.XL_DB_USERNAME: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">db username from previous installation</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="iii-to-setup-haproxynginx">iii. To setup haproxy/nginx.<a aria-hidden="true" class="hash-link" href="#iii-to-setup-haproxynginx" title="Direct link to heading">​</a></h3><ul><li><p>To enable haproxy setup   </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.haproxy-ingress.install </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.nginx-ingress-controller.install </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.ingress.path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">## in the spec.ingress.annotations replace all nginx. settings and put:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   kubernetes.io/ingress.class: </span><span class="token string" style="color:#e3116c">&quot;haproxy&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ingress.kubernetes.io/ssl-redirect: </span><span class="token string" style="color:#e3116c">&quot;false&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ingress.kubernetes.io/rewrite-target: /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ingress.kubernetes.io/affinity: cookie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ingress.kubernetes.io/session-cookie-name: JSESSIONID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ingress.kubernetes.io/session-cookie-strategy: prefix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ingress.kubernetes.io/config-backend: </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   option httpchk GET /ha/health HTTP/1.0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>To enable nginx controller</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.haproxy-ingress.install </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.nginx-ingress-controller.install </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>To enable external nginx or haproxy</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.haproxy-ingress.install </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.nginx-ingress-controller.install </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">.  </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> .spec.ingress.annotations.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   kubernetes.io/ingress.class: </span><span class="token string" style="color:#e3116c">&quot;&lt;external ingress class&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">.   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.ingress.hosts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">external nginxor haproxy hosts</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="iii-to-setup-oidc">iii. To setup oidc<a aria-hidden="true" class="hash-link" href="#iii-to-setup-oidc" title="Direct link to heading">​</a></h3><ul><li>By default keycloak will be enabled as default oidc provider.<ul><li><p>To disable oidc and keycloak.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.keycloak.install </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.enabled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">  </span><span class="token boolean" style="color:#36acaa">false</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>To disable keycloak and enable external oidc.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.keycloak.install </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.enabled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">  </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.external </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">##  update the below fields with external oidc configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.accessTokenUri:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.clientId:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.clientSecret:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.emailClaim:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.external:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.fullNameClaim:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.issuer:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.keyRetrievalUri:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.logoutUri:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.postLogoutRedirectUri:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.redirectUri:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.rolesClaim:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc.userAuthorizationUri:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.oidc</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">userNameClaim:</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>To enable keycloak, with default embedded database.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>  Known issue: in 22.1.4</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">* Issue 1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * If the Previous installation using external database for xl-deploy.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * When we try to upgrade to latest 22.1.4 with keycloak enabled with embedded database, then we will be end using embedded database for both deploy and keycloak.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       &quot;.spec.UseExistingDB.enabled&quot;, has no effects.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* Issue 2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * If the Previous installation using embedded database for xl-deploy.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * When we try to upgrade to latest 22.1.4 with keycloak enabled with embedded database.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        * Post upgrade keycloak pod failed to start with below error.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Caused by: org.postgresql.util.PSQLException: FATAL: password authentication failed for user &quot;keycloak&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          * We need to Connect to the pod/dai-xld-postgresql-0 pod and create the keycloak database.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          * kuebctl exec -it pod/dai-xld-postgresql-0 -- bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          * psql -U postgres  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              note : Postgres password from previous installation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          * create database keycloak;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          * create user keycloak with encrypted password &#x27;keycloak&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          * grant all privileges on database keycloak to keycloak;            </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    .spec.keycloak.install </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .spec.oidc.enabled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">  </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .spec.oidc.external </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .spec.postgresql.install </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .spec.postgresql.persistence.storageClass </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">storageClass specific to provider</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .spec.keycloak.ingress.console.rules</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.host </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">hosts </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> keycloak</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .spec.keycloak.ingress.rules</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.host </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">hosts </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> keycloak</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>To enable keycloak, with external database.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">```shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .spec.keycloak.install = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .spec.oidc.enabled =  true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .spec.oidc.external = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .spec.postgresql.install = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .spec.postgresql.persistence.storageClass = &lt;storageClass specific to provider&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .spec.keycloak.ingress.console.rules[0].host = &lt;hosts for keycloak&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .spec.keycloak.ingress.rules[0].host = &lt;hosts for keycloak&gt;            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p> We need to set the External DB in .spec.keycloak.extraEnv.
Refer docs for more details : <a href="https://docs.digital.ai/bundle/devops-release-version-v.22.1/page/release/how-to/k8s-operator/keycloak-configuration_for_k8s_operator.html" target="_blank" rel="noopener noreferrer">keycloak-configuration_for_k8s_operator</a></p></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="iv-to-update-the-rabbitmq-persistence-storageclass">iv. To update the rabbitmq Persistence storageclass.<a aria-hidden="true" class="hash-link" href="#iv-to-update-the-rabbitmq-persistence-storageclass" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">   .spec.rabbitmq.persistence.storageClass: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Storage Class to be defined </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> RabbitMQ</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="v-to-reuse-existing-claim-for-postgresrabbitmq">v. To reuse existing claim for postgres/rabbitmq<a aria-hidden="true" class="hash-link" href="#v-to-reuse-existing-claim-for-postgresrabbitmq" title="Direct link to heading">​</a></h3><ul><li><p>If the release name is different from &quot;dai-xld&quot; and if we are using embedded database, we need to reuse the existing Claim, for data persistence.</p><ul><li>Update the following field with existing claim.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">          .spec.postgresql.persistence.existingClaim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .spec.rabbitmq.persistence.existingClaim --</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> not required, as we dont save any data.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">eg:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .spec.postgresql.persistence.existingClaim: data-xld-production-postgresql-0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p> If we are having more than one existing PVC for rabbitmq, we don&#x27;t use existingClaim for rabbitmq configuration, instead we can follow the other approach mentioned below for PV reuse.</p></div></div><ul><li>Post helm uninstall, we can also edit postgres/rabbitmq PV as follows, to create the new PVC with existing PV.<ul><li>Update the postgres pv with following details.      <div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">            claimRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              kind: PersistentVolumeClaim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              name: data-dai-xld-postgresql-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              namespace: default   </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li>Update the rabbitmq pv with following details if we need to reuse the PV of rabbitmq.<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">            claimRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              kind: PersistentVolumeClaim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              name: data-dai-xld-rabbitmq-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              namespace: default   </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li>Remove the following from PV <!-- -->[postgres/rabbitmq]<!-- --> while editing.<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">           claimRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            uid:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            resourceVersion:</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="7-bring-up-the-xl-deploy-in-docker">7. Bring up the xl-deploy in docker.<a aria-hidden="true" class="hash-link" href="#7-bring-up-the-xl-deploy-in-docker" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> docker run -d -e </span><span class="token string" style="color:#e3116c">&quot;ADMIN_PASSWORD=admin&quot;</span><span class="token plain"> -e </span><span class="token string" style="color:#e3116c">&quot;ACCEPT_EULA=Y&quot;</span><span class="token plain"> -p </span><span class="token number" style="color:#36acaa">4516</span><span class="token plain">:4516 --name xld xebialabs/xl-deploy:22.1.4</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="8-uninstall-helm">8. Uninstall helm.<a aria-hidden="true" class="hash-link" href="#8-uninstall-helm" title="Direct link to heading">​</a></h2><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Before doing helm uninstall, Clean up deploy work directory:</p><ul><li><a href="https://docs.xebialabs.com/v.22.1/deploy/concept/the-xl-deploy-work-directory/#clean-up-the-work-directory" target="_blank" rel="noopener noreferrer">Clean up deploy Work directory</a></li></ul></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> helm uninstall </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">release name</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="9-below-steps-are-specific-to-aws-eks-cluster-with-sso-access">9. Below steps are specific to AWS EKS Cluster, with SSO access.<a aria-hidden="true" class="hash-link" href="#9-below-steps-are-specific-to-aws-eks-cluster-with-sso-access" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="1-verify-if-we-have-clusterrole-configured-with-assumerole-trustpolicy">1. Verify if we have clusterRole configured with assumeRole trustPolicy.<a aria-hidden="true" class="hash-link" href="#1-verify-if-we-have-clusterrole-configured-with-assumerole-trustpolicy" title="Direct link to heading">​</a></h3><ul><li>Update the ClusterRole TrustPolicy with AssumeRole.<div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user.html" target="_blank" rel="noopener noreferrer">Refer AWS Documentation - Creating a role to delegate permissions to an IAM user</a>  </p></div></div></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;Effect&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Allow&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;Principal&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">&quot;AWS&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;add role or user arn here&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;Action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sts:AssumeRole&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="2-configure-iam-users-or-roles-to-your-amazon-eks-cluster">2. Configure IAM users or roles to your Amazon EKS cluster.<a aria-hidden="true" class="hash-link" href="#2-configure-iam-users-or-roles-to-your-amazon-eks-cluster" title="Direct link to heading">​</a></h3><ul><li>Update aws-auth configmap of Cluster with the RoleArn and RoleName.<div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p><a href="https://docs.aws.amazon.com/eks/latest/userguide/add-user-role.html" target="_blank" rel="noopener noreferrer">Refer AWS Documentation - Add IAM users or roles to your Amazon EKS cluster</a></p></div></div></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">mapRoles</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">groups</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> system</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">bootstrappers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> system</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rolearn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;add role arn</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;add role name</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="10-run-the-following-command">10. Run the following command.<a aria-hidden="true" class="hash-link" href="#10-run-the-following-command" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> xl apply -f xebialabs.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="11-verify-the-pvc-and-pv">11. Verify the PVC and PV.<a aria-hidden="true" class="hash-link" href="#11-verify-the-pvc-and-pv" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data-dai-xld-rabbitmq-0                             Bound    pvc-eabd8a4b-8f40-4419-aed6-00f5dfe71982   8Gi        RWO            aws-efs-provisioner   2m11s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data-dir-dai-xld-digitalai-deploy-cc-server-0       Bound    pvc-59ef0be3-37ea-4f89-b7a5-693c2cb9ede2   500M       RWO            aws-efs-provisioner   2m11s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data-dir-dai-xld-digitalai-deploy-master-0          Bound    pvc-64444985-8e98-406c-984f-1d12449f039f   10Gi       RWO            aws-efs-provisioner   127m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data-dir-dai-xld-digitalai-deploy-worker-0          Bound    pvc-5ad67b27-027c-4636-b2b6-8a1e288c6251   5Gi        RWO            aws-efs-provisioner   65m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data-xld-production-rabbitmq-0                      Bound    pvc-8c0a04a8-7657-4239-9faa-dafac99f4d6e   8Gi        RWO            aws-efs-provisioner   136m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">work-dir-xld-production-digitalai-deploy-worker-0   Bound    pvc-12c4da86-3b09-4f87-a842-c1b65cae0136   5Gi        RWO            aws-efs-provisioner   136m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> kubectl get </span><span class="token function" style="color:#d73a49">pv</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS     CLAIM                                                       STORAGECLASS          REASON   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-12c4da86-3b09-4f87-a842-c1b65cae0136   5Gi        RWO            Retain           Bound      default/work-dir-xld-production-digitalai-deploy-worker-0   aws-efs-provisioner            136m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-59ef0be3-37ea-4f89-b7a5-693c2cb9ede2   500M       RWO            Delete           Bound      default/data-dir-dai-xld-digitalai-deploy-cc-server-0       aws-efs-provisioner            2m48s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-5ad67b27-027c-4636-b2b6-8a1e288c6251   5Gi        RWO            Retain           Bound      default/data-dir-dai-xld-digitalai-deploy-worker-0          aws-efs-provisioner            65m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-64444985-8e98-406c-984f-1d12449f039f   10Gi       RWO            Retain           Bound      default/data-dir-dai-xld-digitalai-deploy-master-0          aws-efs-provisioner            128m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-8c0a04a8-7657-4239-9faa-dafac99f4d6e   8Gi        RWO            Retain           Bound      default/data-xld-production-rabbitmq-0                      aws-efs-provisioner            136m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-c7aa5a61-594d-4537-ad2e-dbc18d441b91   10Gi       RWO            Retain           Released   default/xld-production-digitalai-deploy                     aws-efs-provisioner            136m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-eabd8a4b-8f40-4419-aed6-00f5dfe71982   8Gi        RWO            Delete           Bound      default/data-dai-xld-rabbitmq-0                             aws-efs-provisioner            2m48s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Note:</p><ul><li>We will see new PVC and PV created for rabbitmq, we can delete the old PVC and PV.<ul><li>kubectl delete pvc data-xld-production-rabbitmq-0</li><li>kubectl delete pv pvc-8c0a04a8-7657-4239-9faa-dafac99f4d6e</li></ul></li><li>We can reuse the existing claim for postgres.</li><li>We are using newly created PVC data-dir-dai-xld-digitalai-deploy-master-0 for xl-deploy master pod.</li><li>We are using newly created PVC data-dir-dai-xld-digitalai-deploy-worker-0 for xl-deploy worker pod.</li></ul></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/xl-deploy-kubernetes-operator/docs/manual/move_pvc_to_other_namespace"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->move_pvc_to_other_namespace</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#1-backup-everything" class="table-of-contents__link toc-highlight">1. Backup everything</a></li><li><a href="#2-be-sure-to-not-delete-pvs-with-your-actions-and-update-pv--reclaim-policy-to-retain" class="table-of-contents__link toc-highlight">2. Be sure to not delete PVs with your actions and update PV  RECLAIM POLICY To Retain</a></li><li><a href="#3-creating-new-pvc-for-dai-deploy-master-by-copying-pv-data" class="table-of-contents__link toc-highlight">3. Creating new PVC for dai-deploy master by copying PV data.</a><ul><li><a href="#i-make-the-copy-of-the-pvc-xld-production-digitalai-deployyaml-for-the-later-reference" class="table-of-contents__link toc-highlight">i. Make the copy of the pvc-xld-production-digitalai-deploy.yaml for the later reference.</a></li><li><a href="#ii-manually-create-pvc-data-dir-dai-xld-digitalai-deploy-master-0-as-mentioned-below" class="table-of-contents__link toc-highlight">ii. Manually create pvc data-dir-dai-xld-digitalai-deploy-master-0 as mentioned below.</a></li><li><a href="#iii--create-pvc-dai-xld-digitalai-deploy" class="table-of-contents__link toc-highlight">iii.  Create PVC dai-xld-digitalai-deploy.</a></li><li><a href="#iv-verify-if-pv-bounded" class="table-of-contents__link toc-highlight">iv. Verify if PV bounded</a></li><li><a href="#v-update-the-reclaim-policy-to-retain-for-newly-created-pv-of-data-dir-dai-xld-digitalai-deploy-master-0" class="table-of-contents__link toc-highlight">v. Update the Reclaim policy to Retain, for newly created pv of data-dir-dai-xld-digitalai-deploy-master-0.</a></li><li><a href="#vi-start-the-following-pod-for-accessing-the-newly-created-pvc-data-dir-dai-xld-digitalai-deploy-master-0" class="table-of-contents__link toc-highlight">vi. Start the following pod for accessing the newly created PVC data-dir-dai-xld-digitalai-deploy-master-0.</a></li><li><a href="#vii-copy-data-and-give-persmission" class="table-of-contents__link toc-highlight">vii. Copy data and Give Persmission.</a></li><li><a href="#viii--delete-the-pod" class="table-of-contents__link toc-highlight">viii.  Delete the pod.</a></li></ul></li><li><a href="#4-creating-new-pvc-for-dai-deploy-worker-by-copying-pv-data" class="table-of-contents__link toc-highlight">4. Creating new PVC for dai-deploy worker by copying PV data.</a><ul><li><a href="#i-make-the-copy-of-the-pvc-work-dir-xld-production-digitalai-deploy-worker-0yaml-for-the-later-reference" class="table-of-contents__link toc-highlight">i. Make the copy of the pvc-work-dir-xld-production-digitalai-deploy-worker-0.yaml for the later reference.</a></li><li><a href="#ii-manually-create-pvc-data-dir-dai-xld-digitalai-deploy-worker-0-as-mentioned-below" class="table-of-contents__link toc-highlight">ii. Manually create pvc data-dir-dai-xld-digitalai-deploy-worker-0 as mentioned below.</a></li><li><a href="#iii--create-pvc-dai-xld-digitalai-deploy-1" class="table-of-contents__link toc-highlight">iii.  Create PVC dai-xld-digitalai-deploy.</a></li><li><a href="#iv-verify-if-pv-bounded-1" class="table-of-contents__link toc-highlight">iv. Verify if PV bounded</a></li><li><a href="#v-update-the-reclaim-policy-to-retain-for-newly-created-pv-of-data-dir-dai-xld-digitalai-deploy-worker-0" class="table-of-contents__link toc-highlight">v. Update the Reclaim policy to Retain, for newly created pv of data-dir-dai-xld-digitalai-deploy-worker-0.</a></li><li><a href="#vi-start-the-following-pod-for-accessing-the-newly-created-pvc-data-dir-dai-xld-digitalai-deploy-worker-0" class="table-of-contents__link toc-highlight">vi. Start the following pod for accessing the newly created PVC data-dir-dai-xld-digitalai-deploy-worker-0.</a></li><li><a href="#vii-copy-data-and-give-persmission-1" class="table-of-contents__link toc-highlight">vii. Copy data and Give Persmission.</a></li><li><a href="#viii--delete-the-pod-1" class="table-of-contents__link toc-highlight">viii.  Delete the pod.</a></li></ul></li><li><a href="#5-run-upgrade-with-dry-run-with-custom-zip-options" class="table-of-contents__link toc-highlight">5. Run upgrade with dry run, with custom zip options.</a></li><li><a href="#5-take-backup-of-existing-password" class="table-of-contents__link toc-highlight">5. Take backup of existing password.</a></li><li><a href="#6-do-following-changes-in-the-xebialabsdai-deploydaideploy_cryaml-based-on-the-requirement" class="table-of-contents__link toc-highlight">6. Do following changes in the xebialabs/dai-deploy/daideploy_cr.yaml, based on the requirement.</a><ul><li><a href="#i-to-update-admin-password" class="table-of-contents__link toc-highlight">i. To update admin password</a></li><li><a href="#ii-if-we-are-using-external-database" class="table-of-contents__link toc-highlight">ii. If we are using external database.</a></li><li><a href="#iii-to-setup-haproxynginx" class="table-of-contents__link toc-highlight">iii. To setup haproxy/nginx.</a></li><li><a href="#iii-to-setup-oidc" class="table-of-contents__link toc-highlight">iii. To setup oidc</a></li><li><a href="#iv-to-update-the-rabbitmq-persistence-storageclass" class="table-of-contents__link toc-highlight">iv. To update the rabbitmq Persistence storageclass.</a></li><li><a href="#v-to-reuse-existing-claim-for-postgresrabbitmq" class="table-of-contents__link toc-highlight">v. To reuse existing claim for postgres/rabbitmq</a></li></ul></li><li><a href="#7-bring-up-the-xl-deploy-in-docker" class="table-of-contents__link toc-highlight">7. Bring up the xl-deploy in docker.</a></li><li><a href="#8-uninstall-helm" class="table-of-contents__link toc-highlight">8. Uninstall helm.</a></li><li><a href="#9-below-steps-are-specific-to-aws-eks-cluster-with-sso-access" class="table-of-contents__link toc-highlight">9. Below steps are specific to AWS EKS Cluster, with SSO access.</a><ul><li><a href="#1-verify-if-we-have-clusterrole-configured-with-assumerole-trustpolicy" class="table-of-contents__link toc-highlight">1. Verify if we have clusterRole configured with assumeRole trustPolicy.</a></li><li><a href="#2-configure-iam-users-or-roles-to-your-amazon-eks-cluster" class="table-of-contents__link toc-highlight">2. Configure IAM users or roles to your Amazon EKS cluster.</a></li></ul></li><li><a href="#10-run-the-following-command" class="table-of-contents__link toc-highlight">10. Run the following command.</a></li><li><a href="#11-verify-the-pvc-and-pv" class="table-of-contents__link toc-highlight">11. Verify the PVC and PV.</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/xl-deploy-kubernetes-operator/docs/intro">Tutorial</a></li><li class="footer__item"><a href="https://github.com/xebialabs/xl-deploy-kubernetes-operator" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Deploy Kubernetes Operator Digital.ai</div></div></div></footer></div>
<script src="/xl-deploy-kubernetes-operator/assets/js/runtime~main.52d18a38.js"></script>
<script src="/xl-deploy-kubernetes-operator/assets/js/main.379efe97.js"></script>
</body>
</html>