<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<title data-react-helmet="true">change-namespace-for-xld-10.3-with-downtime | Deploy Kubernetes Operator</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/change-namespace-for-xld-10.3-with-downtime"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="change-namespace-for-xld-10.3-with-downtime | Deploy Kubernetes Operator"><meta data-react-helmet="true" name="description" content="This is internal documentation. This document can be used only if it was recommended by the Support Team."><meta data-react-helmet="true" property="og:description" content="This is internal documentation. This document can be used only if it was recommended by the Support Team."><link data-react-helmet="true" rel="shortcut icon" href="/xl-deploy-kubernetes-operator/img/digital_ai_deploy.svg"><link data-react-helmet="true" rel="canonical" href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/change-namespace-for-xld-10.3-with-downtime"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/change-namespace-for-xld-10.3-with-downtime" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/change-namespace-for-xld-10.3-with-downtime" hreflang="x-default"><link rel="stylesheet" href="/xl-deploy-kubernetes-operator/assets/css/styles.22a8eaea.css">
<link rel="preload" href="/xl-deploy-kubernetes-operator/assets/js/runtime~main.52d18a38.js" as="script">
<link rel="preload" href="/xl-deploy-kubernetes-operator/assets/js/main.379efe97.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/xl-deploy-kubernetes-operator/"><div class="navbar__logo"><img src="/xl-deploy-kubernetes-operator/img/digital_ai_deploy.svg" alt="Deploy Kubernetes Operator Digital.ai" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/xl-deploy-kubernetes-operator/img/digital_ai_deploy.svg" alt="Deploy Kubernetes Operator Digital.ai" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Deploy Kubernetes Operator</b></a><a class="navbar__item navbar__link navbar__link--active" href="/xl-deploy-kubernetes-operator/docs/intro">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/xebialabs/xl-deploy-kubernetes-operator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-operator/docs/intro">intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Manual installation</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/onprem">onprem</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/openshift">openshift</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/aws-eks">aws-eks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/azure-aks">azure-aks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/gcp-gke">gcp-gke</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/setting-up-custom-namespace">setting-up-custom-namespace</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/change-namespace-for-xld-10.3-with-parallel">change-namespace-for-xld-10.3-with-parallel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/change-namespace-for-xld-10.3-with-downtime">change-namespace-for-xld-10.3-with-downtime</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/move_pvc_to_other_namespace">move_pvc_to_other_namespace</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-deploy-kubernetes-operator/docs/manual/manual-upgrade-for-xld-10">manual-upgrade-for-xld-10</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>change-namespace-for-xld-10.3-with-downtime</h1></header><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>This is internal documentation. This document can be used only if it was recommended by the Support Team.</p></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>This setup is deprecated from the 22.3 version.</p></div></div><header><h1>B. How to change namespace in case there is deploy already running in the default namespace - with downtime</h1></header><h2 class="anchor anchorWithStickyNavbar_31ik" id="prerequisites">Prerequisites<a aria-hidden="true" class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h2><ul><li>The kubectl command-line tool</li><li>Access to a Kubernetes cluster with installed Deploy in the <code>default</code> namespace</li></ul><p>Tested with:</p><ul><li>Deploy operator 10.3.9 with embedded database.</li><li>xl-deploy 10.3.9 upgraded to 22.2.0-621.1206</li><li>xl-cli 22.2.0-621.1206</li><li>Aws EKS cluster</li></ul><p>If you have already setup of the XLD default namespace it is possible to move the deployment to the custom namespace. Here we will use for example
<code>nsxld</code>.</p><p>In the example we will use XLD 10.3 that will be upgraded to 22.2.0-621.1206 version with latest 22.2.x operator image xebialabsunsupported/deploy-operator:22.2.0-621.1206 from the
<a href="https://hub.docker.com/r/xebialabsunsupported/deploy-operator/tags" target="_blank" rel="noopener noreferrer">https://hub.docker.com/r/xebialabsunsupported/deploy-operator/tags</a> and latest operator
package from the <a href="https://nexus.xebialabs.com/nexus/content/repositories/releases/ai/digital/deploy/operator/deploy-operator-aws-eks/22.2.0-621.1206/" target="_blank" rel="noopener noreferrer">nexus</a>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="steps-to-setup-operator-on-the-custom-namespace">Steps to setup operator on the custom namespace<a aria-hidden="true" class="hash-link" href="#steps-to-setup-operator-on-the-custom-namespace" title="Direct link to heading">​</a></h2><p>With following steps you will setup XLD in the custom namespace, by first stopping the setup in the <code>default</code> namespace and after starting it in the custom namespace.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Before doing any of the following steps backup everything:</p><ul><li><ul><li><a href="https://docs.xebialabs.com/v.22.1/deploy/concept/the-xl-deploy-work-directory/#clean-up-the-work-directory" target="_blank" rel="noopener noreferrer">Clean up deploy Work directory</a></li></ul></li><li>database data</li><li>any custom configuration that was done for the operator setup</li><li>any volume related to deploy in the default namespace, for example data from the mounted volumes on the master and worker pod:<ul><li>/opt/xebialabs/xl-deploy-server/central-conf/deploy-server.yaml.template</li><li>/opt/xebialabs/xl-deploy-server/centralConfiguration/deploy-oidc.yaml</li><li>/opt/xebialabs/xl-deploy-server/work</li><li>/opt/xebialabs/xl-deploy-server/conf</li><li>/opt/xebialabs/xl-deploy-server/centralConfiguration</li><li>/opt/xebialabs/xl-deploy-server/ext</li><li>/opt/xebialabs/xl-deploy-server/hotfix/lib</li><li>/opt/xebialabs/xl-deploy-server/hotfix/plugins</li><li>/opt/xebialabs/xl-deploy-server/hotfix/satellite-lib</li><li>/opt/xebialabs/xl-deploy-server/log</li></ul></li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="b1-create-custom-namespace">B.1. Create custom namespace<a aria-hidden="true" class="hash-link" href="#b1-create-custom-namespace" title="Direct link to heading">​</a></h3><p>Setup custom namespace on Kubernetes cluster, <code>nsxld</code> for example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ kubectl create namespace nsxld</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Replace <code>custom-namespace-1</code> name in this and following steps with your custom namespace name.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="b2-backup-everything-on-cluster">B.2. Backup everything on cluster<a aria-hidden="true" class="hash-link" href="#b2-backup-everything-on-cluster" title="Direct link to heading">​</a></h3><ol><li>Collect all custom changes that are done in the <code>default</code> namespace for XLD resources<ul><li>StatefulSets</li><li>Deployments</li><li>ConfigMaps</li><li>Secrets</li><li>CustomResource</li><li>anything else that was customized</li></ul></li><li>Collect any other change that was done during initial setup according to the
<a href="https://docs.xebialabs.com/v.22.1/deploy/how-to/k8s-operator/install-deploy-using-k8s-operator/#installing-deploy-on-amazon-eks" target="_blank" rel="noopener noreferrer">https://docs.xebialabs.com/v.22.1/deploy/how-to/k8s-operator/install-deploy-using-k8s-operator/#installing-deploy-on-amazon-eks</a></li><li>If you are using your own database and messaging queue setup, do the data backup.</li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Note:
Any data migration is out of scope of this document. For example in case of database data migration, check with your DB admins what to do in that case.
For the external database case the best option is to migrate database to a new database schema, and use that schema on the new namespace.</p></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="b3-prepare-the-deploy-operator">B.3. Prepare the deploy operator<a aria-hidden="true" class="hash-link" href="#b3-prepare-the-deploy-operator" title="Direct link to heading">​</a></h3><ol><li><p>Get the deploy operator package zip for AWS-EKS: deploy-operator-aws-eks-22.2.0-621.1206.zip (correct operator image is already setup in the package).</p></li><li><p>Download and set up the XL CLI setup (xl cli version in this case 22.2.0-621.1206) from <a href="https://nexus.xebialabs.com/nexus/service/local/repositories/releases/content/com/xebialabs/xlclient/xl-client/22.2.0-621.1206/xl-client-22.2.0-621.1206-linux-amd64.bin" target="_blank" rel="noopener noreferrer">https://nexus.xebialabs.com/nexus/service/local/repositories/releases/content/com/xebialabs/xlclient/xl-client/22.2.0-621.1206/xl-client-22.2.0-621.1206-linux-amd64.bin</a>
Do the step 6 from the documentation <a href="https://docs.xebialabs.com/v.22.1/deploy/how-to/k8s-operator/install-deploy-using-k8s-operator/#step-6download-and-set-up-the-xl-cli" target="_blank" rel="noopener noreferrer">Step 6—Download and set up the XL CLI</a></p></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sishwarya@localhost B-defaultns-downtime</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> $ ./xl-client-22.2.0-621.1206-linux-amd64.bin version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CLI version:             </span><span class="token number" style="color:#36acaa">22.2</span><span class="token plain">.0-621.1206</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Git version:             v22.2.0-620.544-1-g520f8bb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">API version XL Deploy:   xl-deploy/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">API version XL Release:  xl-release/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Git commit:              520f8bbd7c61c7d11a16b677838250fa570730a2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Build date:              </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-06-21T11:33:41.580Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GO version:              go1.16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OS/Arch:                 linux/amd64</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="3"><li><p>Do the step 7 from the documentation <a href="https://docs.xebialabs.com/v.22.1/deploy/how-to/k8s-operator/install-deploy-using-k8s-operator/#step-7set-up-the-xl-deploy-container-instance-1" target="_blank" rel="noopener noreferrer">Step 7—Set up the XL Deploy Container instance</a>
Use the 22.2.0-621.1206version of the deploy: <code>docker run -d -e &quot;ADMIN_PASSWORD=admin&quot; -e &quot;ACCEPT_EULA=Y&quot; -p 4516:4516 --name xld xebialabsunsupported/xl-deploy:22.2.0-621.1206</code></p></li><li><p>Run the upgrade setup with a dry run and generate the blueprint file:</p></li></ol><p>Here is sample of the responses:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ [sishwarya@localhost dryrun] $ ../xl-client-22.2.0-621.1206-linux-amd64.bin op --upgrade --dry-run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Select the setup mode? advanced</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Select the Kubernetes setup where the digitalai Devops Platform will be installed or uninstalled: AwsEKS [AWS EKS]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Do you want to use Kubernetes&#x27; current-context from ~/.kube/config? Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Do you want to use the AWS SSO credentials ? No</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Do you want to use the AWS credentials from your ~/.aws/credentials file? Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Do you want to use an custom Kubernetes namespace (current default is &#x27;digitalai&#x27;)? Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Enter the name of the existing Kubernetes namespace where the XebiaLabs DevOps Platform will be installed, updated or undeployed: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connecting to EKS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Product server you want to perform upgrade for daiDeploy [Digital.ai Deploy]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Enter the repository name(eg: &lt;repositoryName&gt;/&lt;imageName&gt;:&lt;tagName&gt;) xebialabsunsupported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Enter the deploy server image name(eg: &lt;repositoryName&gt;/&lt;imageName&gt;:&lt;tagName&gt;) xl-deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Enter the image tag(eg: &lt;repositoryName&gt;/&lt;imageName&gt;:&lt;tagName&gt;) 22.2.0-621.1206</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Enter the deploy task engine image name for version 22 and above (eg: &lt;repositoryName&gt;/&lt;imageName&gt;:&lt;tagName&gt;) deploy-task-engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Choose the version of the XL Deploy for Upgrader setup of operator 22.2.0-621.1206</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Do you want to enable an oidc? Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Do you want to use an existing external oidc configuration from previous installation? No</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Use embedded keycloak? Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Enter Keycloak public URL deploy.keycloak.digitalai-testing.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Use embedded DB for keycloak? Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Select the type of upgrade you want. operatorToOperator [Operator to Operator]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Operator image to use xebialabsunsupported/deploy-operator:22.2.0-621.1206</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Do you want to use custom operator zip file for Deploy? Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Deploy operator zip to use (absolute path or URL to the zip) /home/sishwarya/SprintTicket/S-84982_ns_xld_migration/B-defaultns-downtime/deploy-operator-aws-eks-22.2.0-621.1206.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Enter the name of custom resource definition. digitalaideploys.xld.digital.ai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Enter the name of custom resource. dai-xld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Edit list of custom resource keys that will migrate to the new Deploy CR &lt;Received&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     -------------------------------- ----------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | LABEL                          | VALUE                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     -------------------------------- ----------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | AWSAccessKey                   | *****                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | AWSAccessSecret                | *****                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | AWSSessionToken                | *****                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | CrName                         | dai-xld                                            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | CrdName                        | digitalaideploys.xld.digital.ai                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | DeployImageVersionForUpgrader  | 22.2.0-621.1206                                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | EksClusterName                 | devops-operator-cluster-test-cluster               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | EnableOidc                     | true                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | ImageNameDeploy                | xl-deploy                                          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | ImageNameDeployTaskEngine      | deploy-task-engine                                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | ImageTag                       | 22.2.0-621.1206                                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | IsAwsCfgAvailable              | true                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | K8sApiServerURL                | https://72673EC78289B3B122CAC4CA8E6473C2.gr7.us-.. |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | K8sSetup                       | AwsEKS                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | KeycloakUrl                    | deploy.keycloak.digitalai-testing.com              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | Namespace                      | default                                            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | OperatorImageDeployGeneric     | xebialabsunsupported/deploy-operator:22.2.0-621... |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | OperatorZipDeploy              | /home/sishwarya/SprintTicket/S-84982_ns_xld_migr.. |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | OsType                         | linux                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | PreserveCrValuesDeploy         | .metadata.name\n.spec.XldMasterCount\n.spec.XldW.. |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | RepositoryName                 | xebialabsunsupported                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | ServerType                     | daiDeploy                                          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | UpgradeType                    | operatorToOperator                                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | UseAWSSsoCredentials           | false                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | UseAWSconfig                   | true                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | UseCustomNamespace             | true                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | UseEmbeddedKeycloak            | true                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | UseExistingOidcConf            | false                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | UseKeycloakWithEmbeddedDB      | true                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | UseKubeconfig                  | true                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | UseOperatorZipDeploy           | true                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     -------------------------------- ----------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Do you want to proceed to the deployment with these values? Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? Current CRD resource &quot;digitalaideploys.xld.digital.ai&quot; is used in following CRs and namespaces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name      Namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dai-xld   default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Should CRD be reused. If Yes it will not be deleted, if No we will delete CRD &quot;digitalaideploys.xld.digital.ai&quot;, and all related CRs will be deleted with it. Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Generated files successfully! </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Update central configuration values...  \ Using same custom resource name dai-xld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Update with keycloak values...  | Generated files successfully operatorToOperator upgrade on AwsEKS </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>That will create files and directories in the working directory. The main directory is <code>xebialabs</code> and inside it are all template files that we need to edit.
Check the <code>xebialabs/dai-deploy/daideploy_cr.yaml</code> if all values are correctly set there.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Note:
Ignore question <code>Choose the version of the XL Deploy for Upgrader setup of operator</code>, we are not starting XL Deploy with this step,
because we have it already running in the step B.3.3. </p></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="b4-update-the-deploy-operator-package-to-support-custom-namespace-common-part">B.4. Update the deploy operator package to support custom namespace (common part)<a aria-hidden="true" class="hash-link" href="#b4-update-the-deploy-operator-package-to-support-custom-namespace-common-part" title="Direct link to heading">​</a></h3><p>Update following files (relative to the provider&#x27;s directory) with custom namespace name:</p><table><thead><tr><th align="left">File name</th><th align="left">Yaml path</th><th align="left">Value to set</th></tr></thead><tbody><tr><td align="left">xebialabs/xl-k8s-foundation.yaml <!-- -->[kind: Infrastructure]</td><td align="left">spec<!-- -->[0]<!-- -->.children<!-- -->[0]<!-- -->.children<!-- -->[0]<!-- -->.name</td><td align="left">nsxld</td></tr><tr><td align="left">xebialabs/xl-k8s-foundation.yaml <!-- -->[kind: Infrastructure]</td><td align="left">spec<!-- -->[0]<!-- -->.children<!-- -->[0]<!-- -->.children<!-- -->[0]<!-- -->.namespaceName</td><td align="left">nsxld</td></tr><tr><td align="left">xebialabs/xl-k8s-foundation.yaml <!-- -->[kind: Environments]</td><td align="left">spec<!-- -->[0]<!-- -->.children<!-- -->[0]<!-- -->.members<!-- -->[1]</td><td align="left">- Infrastructure/DIGITALAI/K8s-MASTER/nsxld</td></tr><tr><td align="left">xebialabs/dai-deploy/template-generic/cluster-role-digital-proxy-role.yaml</td><td align="left">metadata.name</td><td align="left">nsxld-xld-operator-proxy-role</td></tr><tr><td align="left">xebialabs/dai-deploy/template-generic/cluster-role-manager-role.yaml</td><td align="left">metadata.name</td><td align="left">nsxld-xld-operator-manager-role</td></tr><tr><td align="left">xebialabs/dai-deploy/template-generic/cluster-role-metrics-reader.yaml</td><td align="left">metadata.name</td><td align="left">nsxld-xld-operator-metrics-reader</td></tr><tr><td align="left">xebialabs/dai-deploy/template-generic/leader-election-rolebinding.yaml</td><td align="left">subjects<!-- -->[0]<!-- -->.namespace</td><td align="left">nsxld</td></tr><tr><td align="left">xebialabs/dai-deploy/template-generic/manager-rolebinding.yaml</td><td align="left">metadata.name</td><td align="left">nsxld-xld-operator-manager-rolebinding</td></tr><tr><td align="left">xebialabs/dai-deploy/template-generic/manager-rolebinding.yaml</td><td align="left">roleRef.name</td><td align="left">nsxld-xld-operator-manager-role</td></tr><tr><td align="left">xebialabs/dai-deploy/template-generic/manager-rolebinding.yaml</td><td align="left">subjects<!-- -->[0]<!-- -->.namespace</td><td align="left">nsxld</td></tr><tr><td align="left">xebialabs/dai-deploy/template-generic/proxy-rolebinding.yaml</td><td align="left">metadata.name</td><td align="left">nsxld-xld-operator-proxy-rolebinding</td></tr><tr><td align="left">xebialabs/dai-deploy/template-generic/proxy-rolebinding.yaml</td><td align="left">roleRef.name</td><td align="left">nsxld-xld-operator-proxy-role</td></tr><tr><td align="left">xebialabs/dai-deploy/template-generic/proxy-rolebinding.yaml</td><td align="left">subjects<!-- -->[0]<!-- -->.namespace</td><td align="left">nsxld</td></tr><tr><td align="left">xebialabs/dai-deploy/template-generic/postgresql-init-keycloak-db.yaml</td><td align="left">metadata.name</td><td align="left">dai-xld-nsxld-postgresql-init-keycloak-db</td></tr><tr><td align="left">xebialabs/dai-deploy/template-generic/postgresql-init-keycloak-db.yaml</td><td align="left">spec.template.metadata.name</td><td align="left">dai-xld-nsxld-postgresql-init-keycloak-db</td></tr><tr><td align="left">xebialabs/dai-deploy/template-generic/postgresql-init-keycloak-db.yaml</td><td align="left">spec.template.spec.initContainers<!-- -->[0]<!-- -->.env.children<!-- -->[0]<!-- -->.value</td><td align="left">dai-xld-nsxld-postgresql</td></tr><tr><td align="left">xebialabs/dai-deploy/template-generic/postgresql-init-keycloak-db.yaml</td><td align="left">spec.template.spec.containers<!-- -->[0]<!-- -->.children<!-- -->[0]<!-- -->.env.children<!-- -->[0]<!-- -->.value</td><td align="left">dai-xld-nsxld-postgresql</td></tr><tr><td align="left">xebialabs/dai-deploy/daideploy_cr.yaml</td><td align="left">metadata.name</td><td align="left">dai-xld-nsxld</td></tr><tr><td align="left">xebialabs/dai-deploy/daideploy_cr.yaml</td><td align="left">spec.keycloak.install</td><td align="left">true</td></tr></tbody></table><p>In the <code>xebialabs/dai-deploy/template-generic/deployment.yaml</code> add <code>env</code> section after <code>spec.template.spec.containers[1].image</code> (in the same level) in case if it is not available:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> xebialabs</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> WATCH_NAMESPACE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">valueFrom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">fieldRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">fieldPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> metadata.namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">livenessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the <code>xebialabs/dai-deploy-operator.yaml</code> delete array element from the <code>spec[0].children[0].deployables</code>, where name is <code>name: custom-resource-definition</code> if it is not already removed during dry-run.
This will not deploy again CRD, as it already exists, when it was deployed for the first time. Example of the element to delete</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> custom</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">resource</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> k8s.ResourcesFile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">fileEncodings</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">&quot;.+\\.properties&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ISO</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">8859</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">mergePatchType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> strategic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">propagationPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Foreground</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">updateMethod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> patch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">createOrder</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">modifyOrder</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">destroyOrder</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!file</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;dai-deploy/template-generic/custom-resource-definition.yaml&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="b4a-update-the-deploy-operator-package-to-support-custom-namespace---only-in-case-of-nginx-ingress-controller">B.4.a. Update the deploy operator package to support custom namespace - only in case of Nginx ingress controller<a aria-hidden="true" class="hash-link" href="#b4a-update-the-deploy-operator-package-to-support-custom-namespace---only-in-case-of-nginx-ingress-controller" title="Direct link to heading">​</a></h3><p>Following changes are in case of usage nginx ingress (default behaviour):</p><table><thead><tr><th align="left">File name</th><th align="left">Yaml path</th><th align="left">Value to set</th></tr></thead><tbody><tr><td align="left">xebialabs/dai-deploy/daideploy_cr.yaml</td><td align="left">spec.ingress.annotations.kubernetes.io/ingress.class</td><td align="left">nginx-dai-xld-nsxld</td></tr><tr><td align="left">xebialabs/dai-deploy/daideploy_cr.yaml</td><td align="left">spec.nginx-ingress-controller.extraArgs.ingress-class</td><td align="left">nginx-dai-xld-nsxld</td></tr><tr><td align="left">xebialabs/dai-deploy/daideploy_cr.yaml</td><td align="left">spec.nginx-ingress-controller.ingressClassResource.name</td><td align="left">nginx-dai-xld-nsxld</td></tr><tr><td align="left">xebialabs/dai-deploy/daideploy_cr.yaml</td><td align="left">spec.nginx-ingress-controller.ingressClassResource.controllerClass</td><td align="left">k8s.io/ingress-nginx-dai-xld-nsxld</td></tr><tr><td align="left">xebialabs/dai-deploy/daideploy_cr.yaml</td><td align="left">spec.keycloak.ingress.annotations.kubernetes.io/ingress.class</td><td align="left">nginx-dai-xld-nsxld</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_31ik" id="b4b-update-the-deploy-operator-package-to-support-custom-namespace---only-in-case-of-haproxy-ingress-controller">B.4.b. Update the deploy operator package to support custom namespace - only in case of Haproxy ingress controller<a aria-hidden="true" class="hash-link" href="#b4b-update-the-deploy-operator-package-to-support-custom-namespace---only-in-case-of-haproxy-ingress-controller" title="Direct link to heading">​</a></h3><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Note:
To setup haproxy instead of default nginx configuration that is provided in the operator package you need to do following changes in the
<code>xebialabs/dai-deploy/daideploy_cr.yaml</code>:</p><ul><li><code>spec.haproxy-ingress.install = true</code></li><li><code>spec.nginx-ingress-controller.install = false</code></li><li><code>spec.ingress.path = &quot;/&quot;</code></li><li>in the <code>spec.ingress.annotations</code> replace all <code>nginx.</code> settings and put:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">      kubernetes.io/ingress.class: &quot;haproxy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ingress.kubernetes.io/ssl-redirect: &quot;false&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ingress.kubernetes.io/rewrite-target: /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ingress.kubernetes.io/affinity: cookie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ingress.kubernetes.io/session-cookie-name: JSESSIONID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ingress.kubernetes.io/session-cookie-strategy: prefix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ingress.kubernetes.io/config-backend: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option httpchk GET /ha/health HTTP/1.0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><p>Following changes are in case of usage haproxy ingress:</p><table><thead><tr><th align="left">File name</th><th align="left">Yaml path</th><th align="left">Value to set</th></tr></thead><tbody><tr><td align="left">xebialabs/dai-deploy/daideploy_cr.yaml</td><td align="left">spec.ingress.annotations.kubernetes.io/ingress.class</td><td align="left">haproxy-dai-xld-custom-namespace-1</td></tr><tr><td align="left">xebialabs/dai-deploy/daideploy_cr.yaml</td><td align="left">spec.haproxy-ingress.controller.ingressClass</td><td align="left">haproxy-dai-xld-custom-namespace-1</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_31ik" id="b5-update-additionally-yaml-files">B.5. Update additionally YAML files<a aria-hidden="true" class="hash-link" href="#b5-update-additionally-yaml-files" title="Direct link to heading">​</a></h3><p>Apply all collected changes from the <code>default</code> namespace to the CR in the deploy operator package <code>xebialabs/dai-deploy/daideploy_cr.yaml</code>.
(The best is to compare new CR <code>xebialabs/dai-deploy/daideploy_cr.yaml</code> with the one from the <code>default</code> namespace)</p><p>Check the YAML files, and update them with additional changes. For example CR YAML and update it with any missing custom configuration. </p><p>If you are using your own database and messaging queue setup, setup it in the same way as in the <code>default</code> namespace,
in the new CR in the deploy operator package <code>xebialabs/dai-deploy/daideploy_cr.yaml</code>.
Database in this case of setup can be reused if there is network visibility in the new namespace where you are moving your installation</p><p>In case, During upgrade if we disabled oidc setup by answering below question</p><ul><li>Do you want to enable an oidc? No,</li></ul><ul><li>But you need to add external oidc configuration.<ul><li>For example, you can do now OIDC setup, add the following fields with value under spec tag, for enabling oidc in the <code>xebialabs/dai-deploy/daideploy_cr.yaml</code></li></ul></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oidc:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    accessTokenUri: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clientId: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clientSecret: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    emailClaim: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    external: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fullNameClaim: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    issuer: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    keyRetrievalUri: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logoutUri: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    postLogoutRedirectUri: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    redirectUri: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rolesClaim: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userAuthorizationUri: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userNameClaim: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scopes: [&quot;openid&quot;]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Replace nulls with correct values, for more info check <a href="https://docs.xebialabs.com/v.22.1/deploy/concept/xl-deploy-oidc-authentication/" target="_blank" rel="noopener noreferrer">documentation</a></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="b6-be-sure-to-not-delete-pvs">B.6. Be sure to not delete PVs<a aria-hidden="true" class="hash-link" href="#b6-be-sure-to-not-delete-pvs" title="Direct link to heading">​</a></h3><p>Do the step from <a href="/xl-deploy-kubernetes-operator/docs/manual/move_pvc_to_other_namespace#c2-be-sure-to-not-delete-pvs-with-your-actions">C.2. Be sure to not delete PVs with you actions</a></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="b7-destroy-xld-in-default-namespace">B.7. Destroy XLD in default namespace<a aria-hidden="true" class="hash-link" href="#b7-destroy-xld-in-default-namespace" title="Direct link to heading">​</a></h3><p>Do the step from <a href="/xl-deploy-kubernetes-operator/docs/manual/move_pvc_to_other_namespace#c3-stop-everything-that-is-using-xld-pvc-s-and-other-pvc-if-needed">C.3. Stop everything that is using XLD PVC-s</a></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="b8-move-existing-pvcs-to-the-custom-namespace">B.8. Move existing PVCs to the custom namespace<a aria-hidden="true" class="hash-link" href="#b8-move-existing-pvcs-to-the-custom-namespace" title="Direct link to heading">​</a></h3><p>There are 3 options from the step from <a href="/xl-deploy-kubernetes-operator/docs/manual/move_pvc_to_other_namespace#c4-move-existing-pvc-to-the-custom-namespace">C.4. Move existing PVC to the custom namespace</a></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="b81-do-the-following-changes-in-master-pvcs">B.8.1 Do the following changes in master PVCs<a aria-hidden="true" class="hash-link" href="#b81-do-the-following-changes-in-master-pvcs" title="Direct link to heading">​</a></h3><ul><li>Create the master pod in custom-namespace <!-- -->[eg: nsxld]<!-- -->, similar to <a href="/xl-deploy-kubernetes-operator/docs/manual/move_pvc_to_other_namespace#c4option_12-master---start-following-pods">C.4.OPTION_1.2 Master - Start following pods</a> </li><li>Connect to the master pod in custom-namespace.<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -it dai-xld-master-pv-access-nsxld -n nsxld -- </span><span class="token function" style="color:#d73a49">sh</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li>Update the following file in centralConfiguration folder.<ul><li>deploy-repository.yaml.<ul><li>Point it to correct postgres.  <!-- -->[only required if your using embedded database for deploy]<ul><li>db-url: jdbc:postgresql://dai-xld-nsxld-postgresql:5432/xld-db</li></ul></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  ❯ kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -it pod/dai-xld-master-pv-access-nsxld -n nsxld -- </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  / </span><span class="token comment" style="color:#999988;font-style:italic"># cd opt/xebialabs/xl-deploy-server/centralConfiguration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /opt/xebialabs/xl-deploy-server/centralConfiguration </span><span class="token comment" style="color:#999988;font-style:italic"># cat deploy-repository.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  xl:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    repository:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      artifacts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        type: db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      database:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        db-driver-classname: org.postgresql.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        db-password: </span><span class="token string" style="color:#e3116c">&#x27;{cipher}e1d833b5765a924944a6b5e91a089f8fd86dd29a7c9c5d35a8e73f5a968da3f1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        db-url: jdbc:postgresql://dai-xld-nsxld-postgresql:5432/xld-db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        db-username: xld</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li>deploy-task.yaml.<ul><li>Point it to correct rabbitmq.  <!-- -->[only required if your using embedded rabbitmq for deploy]<ul><li>jms-url: amqp://dai-xld-nsxld-rabbitmq.nsxld.svc.cluster.local:5672/%2F<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -it pod/dai-xld-master-pv-access-nsxld -n nsxld -- </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/ </span><span class="token comment" style="color:#999988;font-style:italic"># cd opt/xebialabs/xl-deploy-server/centralConfiguration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/xebialabs/xl-deploy-server/centralConfiguration </span><span class="token comment" style="color:#999988;font-style:italic"># cat deploy-task.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">akka:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  io:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dns:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resolver: async-dns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deploy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  task:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    in-process-worker: </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queue:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      archive-queue-name: xld-archive-queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      external:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jms-driver-classname: com.rabbitmq.jms.admin.RMQConnectionFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jms-password: </span><span class="token string" style="color:#e3116c">&#x27;{cipher}9880501a40e7618fa9bb582d84e4b0e296e9f92a43deaaa4ad63bb98ab69c5b3&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jms-url: amqp://dai-xld-nsxld-rabbitmq.nsxld.svc.cluster.local:5672/%2F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jms-username: guest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      in-process:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxDiskUsage: </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        shutdownTimeout: </span><span class="token number" style="color:#36acaa">60000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: xld-tasks-queue</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul></li></ul></li><li>deploy-server.yaml<ul><li>If keycloak is enabled. <ul><li>Update the property deploy.server.security.auth.provider: oidc, if required change the hostname as well.     </li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -it pod/dai-xld-master-pv-access-nsxld -n nsxld -- </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/ </span><span class="token comment" style="color:#999988;font-style:italic"># cd opt/xebialabs/xl-deploy-server/centralConfiguration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/xebialabs/xl-deploy-server/centralConfiguration </span><span class="token comment" style="color:#999988;font-style:italic"># cat deploy-server.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deploy.server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hostname: dai-xld-nsxld-digitalai-deploy-master-0.dai-xld-nsxld-digitalai-deploy-master.nsxld.svc.cluster.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  license:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    daysBeforeWarning: </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  security:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auth:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      provider: </span><span class="token string" style="color:#e3116c">&quot;oidc&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul></li></ul></li><li>Update the following file in conf folder.<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  * xld-wrapper.conf.common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      * Search for jmx_prometheus_javaagent.jar and update it to &quot;jmx_prometheus_javaagent-0.16.1.jar&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Note : Either update the value or delete the file [xld-wrapper.conf.common], it will be downloaded automatically with the latest changes during startup.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">❯ kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -it pod/dai-xld-master-pv-access-nsxld -n nsxld -- </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/ </span><span class="token comment" style="color:#999988;font-style:italic"># cd opt/xebialabs/xl-deploy-server/conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/xebialabs/xl-deploy-server/conf </span><span class="token comment" style="color:#999988;font-style:italic"># rm -rf xld-wrapper.conf.common</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="b82-do-the-following-changes-in-worker-pvcs">B.8.2 Do the following changes in worker PVCs<a aria-hidden="true" class="hash-link" href="#b82-do-the-following-changes-in-worker-pvcs" title="Direct link to heading">​</a></h3><ul><li>Create the worker pod in custom-namespace <!-- -->[eg: nsxld]<!-- -->.</li><li>Connect to the worker pod</li><li>Update the following file in conf folder.<ul><li>xld-wrapper.conf.common</li><li>Search for jmx_prometheus_javaagent.jar and update it to &quot;jmx_prometheus_javaagent-0.16.1.jar&quot;.
Note : Either update or delete the file <!-- -->[xld-wrapper.conf.common]<!-- -->, it will be downloaded automatically with the latest changes during startup.<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    ❯ kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -it pod/dai-xld-worker-pv-access-nsxld -n nsxld -- </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    / </span><span class="token comment" style="color:#999988;font-style:italic"># cd /opt/xebialabs/deploy-task-engine/conf/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /opt/xebialabs/deploy-task-engine/conf </span><span class="token comment" style="color:#999988;font-style:italic"># rm -rf xld-wrapper.conf.common</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /opt/xebialabs/deploy-task-engine/conf </span><span class="token comment" style="color:#999988;font-style:italic">#</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="b9-deploy-to-the-custom-namespace">B.9. Deploy to the custom namespace<a aria-hidden="true" class="hash-link" href="#b9-deploy-to-the-custom-namespace" title="Direct link to heading">​</a></h3><ol><li>We are using here yaml that was result of the upgrade dry-run in the working directory, so we should apply against following file:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">xl apply -f ./xebialabs.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="2"><li><p>Do the step 9, 10 and 11 from the documentation <a href="https://docs.xebialabs.com/v.22.1/deploy/how-to/k8s-operator/install-deploy-using-k8s-operator/#step-10verify-if-the-deployment-was-successful-1" target="_blank" rel="noopener noreferrer">Step 9—Verify the deployment status</a></p></li><li><p>Troubleshooting</p><ul><li>If cc pod is not initialized, due to below error.</li></ul></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Type     Reason            Age                 From                    Message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ----     ------            ----                ----                    -------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Normal   SuccessfulCreate  55s                 statefulset-controller  create Claim data-dir-dai-xld-nsxld-digitalai-deploy-cc-server-0 Pod dai-xld-nsxld-digitalai-deploy-cc-server-0 </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> StatefulSet dai-xld-nsxld-digitalai-deploy-cc-server success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Warning  FailedCreate      34s </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x13 over 55s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  statefulset-controller  create Pod dai-xld-nsxld-digitalai-deploy-cc-server-0 </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> StatefulSet dai-xld-nsxld-digitalai-deploy-cc-server failed error: Pod </span><span class="token string" style="color:#e3116c">&quot;dai-xld-nsxld-digitalai-deploy-cc-server-0&quot;</span><span class="token plain"> is invalid: spec.initContainers</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.volumeMounts</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.name: Not found: </span><span class="token string" style="color:#e3116c">&quot;source-dir&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Workaround<ul><li>Edit the statefulset of dai-xld-nsxld-digitalai-deploy-cc-server</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> ❯ kubectl edit statefulset.apps/dai-xld-nsxld-digitalai-deploy-cc-server</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Update the Volume section as below.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token key atrule" style="color:#00a4db">persistentVolumeClaim</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token key atrule" style="color:#00a4db">claimName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dir</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dai</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">xld</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">nsxld</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">digitalai</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deploy</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="b10-apply-any-custom-changes">B.10. Apply any custom changes<a aria-hidden="true" class="hash-link" href="#b10-apply-any-custom-changes" title="Direct link to heading">​</a></h3><p>If you have any custom changes that you collected previously in the step 3.3, you can apply them again in this step in the same way as before on the <code>default</code> namespace.</p><p>Check if PVCs and PVs are reused by the new setup in the custom namespace.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="b11-wrap-up">B.11. Wrap-up<a aria-hidden="true" class="hash-link" href="#b11-wrap-up" title="Direct link to heading">​</a></h3><p>Wait for all pods to ready and without any errors.</p><p>If you used same host in the new custom namespace to the one that is on the <code>default</code> namespace, in that case XLD page is still opening from the <code>default</code>
namespace. You need in that case apply step 9.a, after that on the configurated host will be available XLD that is from the new custom namespace.</p><p>List of pods should look like following table, if nginx and keycloak is enabled.:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ NAMESPACE↑           NAME                                                          READY     RESTARTS STATUS  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nsxld         dai-xld-nsxld-digitalai-deploy-cc-server-0                        </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          65m</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nsxld         dai-xld-nsxld-digitalai-deploy-master-0                           </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          14m</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nsxld         dai-xld-nsxld-digitalai-deploy-worker-0                           </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          15m</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nsxld         dai-xld-nsxld-keyclo-0                                            </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          67m</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nsxld         dai-xld-nsxld-nginx-ingress-controller-dbb495ccc-n4x9r            </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          67m</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nsxld         dai-xld-nsxld-nginx-ingress-controller-default-backend-54cqthz8   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          67m</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nsxld         dai-xld-nsxld-postgresql-0                                        </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          67m</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nsxld         dai-xld-nsxld-postgresql-init-keycloak-db-mmvr5                   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Completed   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          68m</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nsxld         dai-xld-nsxld-rabbitmq-0                                          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          67m</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nsxld         xld-operator-controller-manager-759cb85546-g9489                  </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/2     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          68m</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Table could have different entries if you haproxy or using external postgresql and rabbitmq.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="b12-destroy-remains-of-xld-in-default-namespace">B.12 Destroy remains of XLD in default namespace<a aria-hidden="true" class="hash-link" href="#b12-destroy-remains-of-xld-in-default-namespace" title="Direct link to heading">​</a></h4><p>If you are sure that everything is up and running on the new custom namespace, you can destroy remaining setup in the <code>default</code> namespace:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># be careful if you would like really to delete all PVC-s and related PV-s, backup before delete</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># get pvcs related to XLD on default namespace and delete them (list of the pvcs depends on what is enabled in the deployment)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❯ kubectl get pvc -n default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❯ kubectl delete -n default pvc data-dai-xld-rabbitmq-0 </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can also clean up any configmaps or secrets that are in the <code>default</code> namespace and related to the XLD.</p><p>You also delete all PVs that were connected to the XLD installation in the default namespace, and are not migrated and used by the custom namespace.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/xl-deploy-kubernetes-operator/docs/manual/change-namespace-for-xld-10.3-with-parallel"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->change-namespace-for-xld-10.3-with-parallel</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/xl-deploy-kubernetes-operator/docs/manual/move_pvc_to_other_namespace"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">move_pvc_to_other_namespace<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#steps-to-setup-operator-on-the-custom-namespace" class="table-of-contents__link toc-highlight">Steps to setup operator on the custom namespace</a><ul><li><a href="#b1-create-custom-namespace" class="table-of-contents__link toc-highlight">B.1. Create custom namespace</a></li><li><a href="#b2-backup-everything-on-cluster" class="table-of-contents__link toc-highlight">B.2. Backup everything on cluster</a></li><li><a href="#b3-prepare-the-deploy-operator" class="table-of-contents__link toc-highlight">B.3. Prepare the deploy operator</a></li><li><a href="#b4-update-the-deploy-operator-package-to-support-custom-namespace-common-part" class="table-of-contents__link toc-highlight">B.4. Update the deploy operator package to support custom namespace (common part)</a></li><li><a href="#b4a-update-the-deploy-operator-package-to-support-custom-namespace---only-in-case-of-nginx-ingress-controller" class="table-of-contents__link toc-highlight">B.4.a. Update the deploy operator package to support custom namespace - only in case of Nginx ingress controller</a></li><li><a href="#b4b-update-the-deploy-operator-package-to-support-custom-namespace---only-in-case-of-haproxy-ingress-controller" class="table-of-contents__link toc-highlight">B.4.b. Update the deploy operator package to support custom namespace - only in case of Haproxy ingress controller</a></li><li><a href="#b5-update-additionally-yaml-files" class="table-of-contents__link toc-highlight">B.5. Update additionally YAML files</a></li><li><a href="#b6-be-sure-to-not-delete-pvs" class="table-of-contents__link toc-highlight">B.6. Be sure to not delete PVs</a></li><li><a href="#b7-destroy-xld-in-default-namespace" class="table-of-contents__link toc-highlight">B.7. Destroy XLD in default namespace</a></li><li><a href="#b8-move-existing-pvcs-to-the-custom-namespace" class="table-of-contents__link toc-highlight">B.8. Move existing PVCs to the custom namespace</a></li><li><a href="#b81-do-the-following-changes-in-master-pvcs" class="table-of-contents__link toc-highlight">B.8.1 Do the following changes in master PVCs</a></li><li><a href="#b82-do-the-following-changes-in-worker-pvcs" class="table-of-contents__link toc-highlight">B.8.2 Do the following changes in worker PVCs</a></li><li><a href="#b9-deploy-to-the-custom-namespace" class="table-of-contents__link toc-highlight">B.9. Deploy to the custom namespace</a></li><li><a href="#b10-apply-any-custom-changes" class="table-of-contents__link toc-highlight">B.10. Apply any custom changes</a></li><li><a href="#b11-wrap-up" class="table-of-contents__link toc-highlight">B.11. Wrap-up</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/xl-deploy-kubernetes-operator/docs/intro">Tutorial</a></li><li class="footer__item"><a href="https://github.com/xebialabs/xl-deploy-kubernetes-operator" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Deploy Kubernetes Operator Digital.ai</div></div></div></footer></div>
<script src="/xl-deploy-kubernetes-operator/assets/js/runtime~main.52d18a38.js"></script>
<script src="/xl-deploy-kubernetes-operator/assets/js/main.379efe97.js"></script>
</body>
</html>