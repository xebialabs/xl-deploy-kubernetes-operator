"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[233],{7370:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return r},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return c},default:function(){return d}});var a=n(7462),o=n(3366),s=(n(7294),n(3905)),i=["components"],r={sidebar_position:2},l="AWS OpenShift",p={unversionedId:"manual/openshift",id:"manual/openshift",isDocsHomePage:!1,title:"AWS OpenShift",description:"Here it will described how to install manually Deploy k8s cluster with help of operator to Open Shift.",source:"@site/docs/manual/openshift.md",sourceDirName:"manual",slug:"/manual/openshift",permalink:"/xl-deploy-kubernetes-operator/docs/manual/openshift",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"On Premises",permalink:"/xl-deploy-kubernetes-operator/docs/manual/onprem"}},c=[],u={toc:c};function d(e){var t=e.components,r=(0,o.Z)(e,i);return(0,s.kt)("wrapper",(0,a.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"aws-openshift"},"AWS OpenShift"),(0,s.kt)("p",null,"Here it will described how to install manually Deploy k8s cluster with help of operator to Open Shift.\nAs a tool to work with is taken AWS OpenShift."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"First check the doc how to work with an ",(0,s.kt)("a",{parentName:"li",href:"https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/onprem"},"Operator on Premises"),",\nas those details are not covered here."),(0,s.kt)("li",{parentName:"ul"},"You should configure your ",(0,s.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html"},"AWS CLI locally")),(0,s.kt)("li",{parentName:"ul"},"Create an account in RedHat and follow the procedure of installing ROSA ",(0,s.kt)("a",{parentName:"li",href:"https://docs.openshift.com/rosa/rosa_getting_started/rosa-installing-rosa.html"},"https://docs.openshift.com/rosa/rosa_getting_started/rosa-installing-rosa.html")),(0,s.kt)("li",{parentName:"ul"},"Once it is done, it's very important to ",(0,s.kt)("a",{parentName:"li",href:"https://docs.openshift.com/rosa/rosa_getting_started/rosa-config-identity-providers.html"},"configure IdP (identity provider)")," in order to be able to access the cluster via ",(0,s.kt)("inlineCode",{parentName:"li"},"serverURL")," and ",(0,s.kt)("inlineCode",{parentName:"li"},"token"),".\nThese 2 parameters are used in Deploy to have a communication with OpenShift cluster.",(0,s.kt)("br",{parentName:"li"}),"If it was configured correctly this command will succeed:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"oc login\xa0--token=TOKEN\xa0--server=SERVER_URL\n")),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"SERVER_URL")," you can find the next way."),(0,s.kt)("p",null,"First find the cluster's console URL in the output of command:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"rosa describe cluster --cluster=CLUSTER_NAME\n")),(0,s.kt)("p",null,"When you open it, you will see on ",(0,s.kt)("inlineCode",{parentName:"p"},"Cluster")," tab your new created cluster\n",(0,s.kt)("img",{alt:"Openshift Clusters",src:n(2556).Z})),(0,s.kt)("p",null,"Click on it, and open ",(0,s.kt)("inlineCode",{parentName:"p"},"Networking")," tab\n",(0,s.kt)("img",{alt:"Openshift Networking",src:n(5138).Z}),"."),(0,s.kt)("p",null,'"Control Plane API endpoint" is your SERVER_URL.\n"Default application router" you have to use in ',(0,s.kt)("inlineCode",{parentName:"p"},"DigitalaiDeployOcp")," to specify the ",(0,s.kt)("inlineCode",{parentName:"p"},"hosts")," field.\nOnly be aware that it should have only hostname, no protocol or port defined. So for this example it will be"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"hosts:\n    - router-default.apps.acierto.lnfl.p1.openshiftapps.com\n")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"router-default")," is a name of a default router configured by OpenShift.\nYou can also find it in OpenShift Console UI:"),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"OpenShift Route",src:n(5608).Z})," "),(0,s.kt)("p",null,"Also very important thing, when IdP is created, you have to create a user with the same name. You can find it here:\n",(0,s.kt)("img",{alt:"OpenShift Access Control",src:n(2171).Z})),(0,s.kt)("p",null,"When all configuration is done, and you deployed the Operator, you can interact with the cluster with help of ",(0,s.kt)("inlineCode",{parentName:"p"},"oc"),".\nJust instead of ",(0,s.kt)("inlineCode",{parentName:"p"},"kubectl")," will be ",(0,s.kt)("inlineCode",{parentName:"p"},"oc"),"."),(0,s.kt)("h1",{id:"how-to-configure-aws-efs"},"How to configure AWS EFS"),(0,s.kt)("p",null,"This is ",(0,s.kt)("a",{parentName:"p",href:"https://docs.openshift.com/container-platform/4.2/storage/persistent_storage/persistent-storage-efs.html"},"the article")," to start the configuration from.\nThe most important points which are missing there:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Network should attach a mounted target with VPC and Subnet Group which is the same as where cluster is created.")),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"OpenShift EFS Network",src:n(4876).Z})," "),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"OpenShift AWS EC2",src:n(1784).Z})),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Make sure that your SubGroup has a configuration for NFS.")),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"OpenShift EFS SubGroup",src:n(7865).Z}),"\n",(0,s.kt)("img",{alt:"OpenShift EFS SubGroup",src:n(5423).Z})),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},'Access point should be created to a root folder "/" with 777 permissions to any random ID user.')),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"OpenShift EFS Access Point",src:n(5802).Z})),(0,s.kt)("p",null,"After you make ",(0,s.kt)("inlineCode",{parentName:"p"},"efs-provisioner")," up and running you have to switch your storageclass to aws-efs as default, it will look like"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"bnechyporenko@Bogdan-Nechyporenko ~ % oc get sc\nNAME                PROVISIONER             RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE\naws-efs (default)   openshift.org/aws-efs   Delete          Immediate              false                  30h\nefs-sc              efs.csi.aws.com         Delete          Immediate              false                  24h\ngp2                 kubernetes.io/aws-ebs   Delete          WaitForFirstConsumer   true                   5d3h\ngp2-csi             ebs.csi.aws.com         Delete          WaitForFirstConsumer   true                   5d3h\n")),(0,s.kt)("p",null,"Commands to do it:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},'oc patch storageclass aws-efs -p \'{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}\'\n')),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},'oc patch storageclass gp2 -p \'{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"false"}}}\'\n')),(0,s.kt)("p",null,"When configured all properly, all pods have to be up and running"),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"OpenShift state",src:n(9974).Z})),(0,s.kt)("p",null,"and server accessed by the provided host in the configuration"),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"Openshift Cluster UI",src:n(3102).Z})),(0,s.kt)("h1",{id:"troubleshooting"},"Troubleshooting"),(0,s.kt)("p",null,"In some cases you can face with issues in PostreSQL and have no actual error logs.\nTo overcome it, you have to enable debug mode for it. You can do it by enabling debug to ",(0,s.kt)("inlineCode",{parentName:"p"},"true")," in values:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"image:\n  debug: true\n  pullPolicy: IfNotPresent\n  registry: docker.io\n  repository: bitnami/postgresql\n  tag: 11.9.0-debian-10-r48\n")))}d.isMDXComponent=!0},2171:function(e,t,n){t.Z=n.p+"assets/images/openshift-access-control-18eb709f850049521a99563fb519525e.png"},1784:function(e,t,n){t.Z=n.p+"assets/images/openshift-aws-ec2-bb1488791613b86caaf863031978d45a.png"},9974:function(e,t,n){t.Z=n.p+"assets/images/openshift-cluster-state-993454d2f0f9b4e243ec7846e07efe52.png"},3102:function(e,t,n){t.Z=n.p+"assets/images/openshift-cluster-ui-28a28d6092da34e41531dfc2c2512dc2.png"},2556:function(e,t,n){t.Z=n.p+"assets/images/openshift-clusters-d90ff2979f324bce845b395ba243094d.png"},5802:function(e,t,n){t.Z=n.p+"assets/images/openshift-efs-access-point-77190a119090065989528883186be7e5.png"},4876:function(e,t,n){t.Z=n.p+"assets/images/openshift-efs-network-eed808b8d388c99d8c42792976555666.png"},5423:function(e,t,n){t.Z=n.p+"assets/images/openshift-efs-subgroup-nfs-0900a30edee7c64eb422c130830c6a4c.png"},7865:function(e,t,n){t.Z=n.p+"assets/images/openshift-efs-subgroup-bf76771db981a85c98d1d871a522cb6c.png"},5138:function(e,t,n){t.Z=n.p+"assets/images/openshift-networking-d5709f0f6fe57bc2c8fd9d5b9ceced9c.png"},5608:function(e,t,n){t.Z=n.p+"assets/images/openshift-route-fbf8e7730038d17c382605cf4306a663.png"}}]);