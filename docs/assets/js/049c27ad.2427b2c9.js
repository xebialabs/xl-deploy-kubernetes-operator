"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[898],{3905:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return m}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=n.createContext({}),u=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},p=function(e){var t=u(e.components);return n.createElement(i.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=u(a),m=r,k=d["".concat(i,".").concat(m)]||d[m]||c[m]||l;return a?n.createElement(k,s(s({ref:t},p),{},{components:a})):n.createElement(k,s({ref:t},p))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,s=new Array(l);s[0]=d;var o={};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var u=2;u<l;u++)s[u]=a[u];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},3698:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return o},contentTitle:function(){return i},metadata:function(){return u},toc:function(){return p},default:function(){return d}});var n=a(7462),r=a(3366),l=(a(7294),a(3905)),s=["components"],o={sidebar_position:4,data:"Internal Only"},i=void 0,u={unversionedId:"manual/azure-aks",id:"manual/azure-aks",isDocsHomePage:!1,title:"azure-aks",description:"This is internal documentation. This document can be used only if it was recommended by the Support Team.",source:"@site/docs/manual/azure-aks.md",sourceDirName:"manual",slug:"/manual/azure-aks",permalink:"/xl-deploy-kubernetes-operator/docs/manual/azure-aks",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,data:"Internal Only"},sidebar:"tutorialSidebar",previous:{title:"aws-eks",permalink:"/xl-deploy-kubernetes-operator/docs/manual/aws-eks"},next:{title:"gcp-gke",permalink:"/xl-deploy-kubernetes-operator/docs/manual/gcp-gke"}},p=[{value:"Create the cluster",id:"create-the-cluster",children:[{value:"Create an AKS cluster",id:"create-an-aks-cluster",children:[],level:3}],level:2},{value:"Storage class",id:"storage-class",children:[{value:"Azure Files Dynamic",id:"azure-files-dynamic",children:[],level:3}],level:2},{value:"Setting up Azure DNS",id:"setting-up-azure-dns",children:[],level:2},{value:"Start operator",id:"start-operator",children:[{value:"Troubleshouting",id:"troubleshouting",children:[],level:3}],level:2},{value:"Delete the cluster",id:"delete-the-cluster",children:[],level:2}],c={toc:p};function d(e){var t=e.components,o=(0,r.Z)(e,s);return(0,l.kt)("wrapper",(0,n.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"This is internal documentation. This document can be used only if it was recommended by the Support Team."))),(0,l.kt)("h1",{id:"azure-aks"},"Azure AKS"),(0,l.kt)("p",null,"Here it will be described how to install manually Deploy k8s cluster with help of operator to Azure."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"You should install ",(0,l.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/cli/azure/install-azure-cli"},"Azure CLI locally")),(0,l.kt)("li",{parentName:"ul"},"Use kubernetes walkthrough, in the next section with ",(0,l.kt)("inlineCode",{parentName:"li"},"az")," to setup k8s cluster. Here are more detailed description: ",(0,l.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough"},"Deploy an Azure Kubernetes Service cluster using the Azure CLI")," as alternative use ",(0,l.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough-portal"},"GUI alternative"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Check first Prerequisites to ",(0,l.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli"},"Sign in with Azure CLI"))))),(0,l.kt)("h2",{id:"create-the-cluster"},"Create the cluster"),(0,l.kt)("p",null,"Here are basic steps to setup k8s cluster."),(0,l.kt)("p",null,"Create a resource group"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'\u276f az group create --name xld-operator-group --location germanywestcentral\n{\n  "id": "/subscriptions/.../resourceGroups/xld-operator-group",\n  "location": "germanywestcentral",\n  "managedBy": null,\n  "name": "xld-operator-group",\n  "properties": {\n    "provisioningState": "Succeeded"\n  },\n  "tags": null,\n  "type": "Microsoft.Resources/resourceGroups"\n}\n')),(0,l.kt)("p",null,"Create new TLS private key (in other way it is using default key from SSL config)"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'ssh-keygen -f ssh-key-xld-operator-cluster -N "" -m pem\n')),(0,l.kt)("p",null,"This will create new private and public key files. We will use public file ",(0,l.kt)("inlineCode",{parentName:"p"},"ssh-key-xld-operator-cluster.pub")," in the next step.   "),(0,l.kt)("h3",{id:"create-an-aks-cluster"},"Create an AKS cluster"),(0,l.kt)("p",null,"Check available k8s versions, if default one is 1.20.x it is OK,\nin other case in next step during cluster creation use option ",(0,l.kt)("inlineCode",{parentName:"p"},"--kubernetes-version")," with available 1.20.x version as value:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"az aks get-versions --location germanywestcentral\n")),(0,l.kt)("p",null,"Create an AKS cluster "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'\u276f az aks create --resource-group xld-operator-group  --name xld-operator-cluster --node-count 1 --enable-addons monitoring --ssh-key-value ssh-key-xld-operator-cluster.pub\nAAD role propagation done[############################################]  100.0000%{\n  "aadProfile": null,\n  ...\n  "sku": {\n    "name": "Basic",\n    "tier": "Free"\n  },\n  "tags": null,\n  "type": "Microsoft.ContainerService/ManagedClusters",\n  "windowsProfile": null\n}\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"If you need to scale number of replicas 1 default node will not be enough (default node-vm-size is ",(0,l.kt)("inlineCode",{parentName:"p"},"Standard_DS2_v2")," with 7GiB and 2vCPU),\nso use ",(0,l.kt)("inlineCode",{parentName:"p"},"--node-count 2")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"--node-vm-size Standard_DS3_v2")," with 14GiB and 4vCPU."))),(0,l.kt)("p",null,"Result on the Azure Portal dashboard:\n",(0,l.kt)("img",{alt:"aks-xld-operator-cluster",src:a(9503).Z})),(0,l.kt)("p",null,"Connect to the cluster"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'\u276f az aks get-credentials --resource-group xld-operator-group --name xld-operator-cluster\nMerged "xld-operator-cluster" as current context in /Users/vpugar/.kube/config\n')),(0,l.kt)("p",null,"Check if your cluster is fully functional"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"\u276f kubectl get node\nNAME                                STATUS   ROLES   AGE     VERSION\naks-nodepool1-32131366-vmss000000   Ready    agent   6h36m   v1.20.9\n")),(0,l.kt)("p",null,"You can take now the keys and URL and update ",(0,l.kt)("inlineCode",{parentName:"p"},"deploy-operator-azure-aks/digitalai-deploy/infrastructure.yaml"),". Following are mappings:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"center"},"Field name"),(0,l.kt)("th",{parentName:"tr",align:"center"},"Path to the cert"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"apiServerURL"),(0,l.kt)("td",{parentName:"tr",align:"center"},"~/.kube/config:clusters","[","name=xld-operator-cluster","]",".cluster.server")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"caCert"),(0,l.kt)("td",{parentName:"tr",align:"center"},"~/.kube/config:clusters","[","name=xld-operator-cluster","]",".cluster.certificate-authority-data")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"tlsCert"),(0,l.kt)("td",{parentName:"tr",align:"center"},"~/.kube/config:users","[","name=clusterUser_xld-operator-group_xld-operator-cluster","]",".user.client-certificate-data")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"tlsPrivateKey"),(0,l.kt)("td",{parentName:"tr",align:"center"},"~/.kube/config:users","[","name=clusterUser_xld-operator-group_xld-operator-cluster","]",".user.client-key-data")))),(0,l.kt)("p",null,"You can use base64 encoded values from the ",(0,l.kt)("inlineCode",{parentName:"p"},"~/.kube/config"),", as is, in that case, from the ",(0,l.kt)("inlineCode",{parentName:"p"},"infrastructure.yaml"),", just remove header/footer lines with ",(0,l.kt)("inlineCode",{parentName:"p"},"-----")," that under that specific key value that you are replacing."),(0,l.kt)("h2",{id:"storage-class"},"Storage class"),(0,l.kt)("p",null,"Get default storage class"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"\u276f kubectl get storageclass\nNAME                PROVISIONER                RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE\nazurefile           kubernetes.io/azure-file   Delete          Immediate              true                   6h36m\nazurefile-premium   kubernetes.io/azure-file   Delete          Immediate              true                   6h36m\ndefault (default)   kubernetes.io/azure-disk   Delete          WaitForFirstConsumer   true                   6h36m\nmanaged-premium     kubernetes.io/azure-disk   Delete          WaitForFirstConsumer   true                   6h36m\n")),(0,l.kt)("p",null,"It should be used ",(0,l.kt)("inlineCode",{parentName:"p"},"default"),", so update all occurrences of storageClass in the ",(0,l.kt)("inlineCode",{parentName:"p"},"xld_v1alpha_digitaldeploy.yaml")," to ",(0,l.kt)("inlineCode",{parentName:"p"},"default")," value."),(0,l.kt)("h3",{id:"azure-files-dynamic"},"Azure Files Dynamic"),(0,l.kt)("p",null,"storageClass ",(0,l.kt)("inlineCode",{parentName:"p"},"default")," is not good enough for the database setup and other shared folders' requirement, so in that case\nthere are multiple ways to create shared data-volumes, here are options:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/aks/azure-disks-dynamic-pv"},"Azure Disk Dynamic")," (can be used by only one node)"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/aks/azure-files-dynamic-pv"},"Azure Files Dynamic")," "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/aks/azure-files-volume"},"Azure Files Static")," "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/aks/azure-nfs-volume"},"NFS server Static")," (NFS Server onto a Virtual Machine)"),(0,l.kt)("li",{parentName:"ul"},"and others, see ",(0,l.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/aks/concepts-storage"},"Storage options for applications in Azure Kubernetes Service (AKS)"))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Following was tested with Azure Files and Disk Dynamic")),(0,l.kt)("p",null,"Create a file named ",(0,l.kt)("inlineCode",{parentName:"p"},"azure-file-sc.yaml"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"kind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: xld-operator-azurefile\nprovisioner: kubernetes.io/azure-file\nmountOptions:\n  - dir_mode=0777\n  - file_mode=0777\n  - uid=0\n  - gid=0\n  - mfsymlinks\n  - cache=strict\n  - actimeo=30\nparameters:\n  skuName: Standard_LRS\n")),(0,l.kt)("p",null,"Using Standard_LRS - standard locally redundant storage (LRS)."),(0,l.kt)("p",null,"Apply it"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"\u276f kubectl apply -f azure-file-sc.yaml\nstorageclass.storage.k8s.io/xld-operator-azurefile created\n")),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"xld-operator-azurefile")," storage class must be marked only the default annotation so that PersistentVolumeClaim objects (without a StorageClass specified) will trigger dynamic provisioning."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'\u276f kubectl patch storageclass xld-operator-azurefile -p \'{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}\'\nstorageclass.storage.k8s.io/xld-operator-azurefile patched\n\u276f kubectl patch storageclass default -p \'{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"false"}}}\'\nstorageclass.storage.k8s.io/default patched\n')),(0,l.kt)("p",null,"Previous setup ",(0,l.kt)("inlineCode",{parentName:"p"},"xld-operator-azurefile")," will not work correctly with PostgreSQL. This is because PostgreSQL requires hard links in the Azure File directory, and since Azure File does not support hard links the pod fails to start.\nSo we need additional storageClass with Azure disk. Create a file named ",(0,l.kt)("inlineCode",{parentName:"p"},"azure-disk-sc.yaml"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"kind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: xld-operator-azuredisk\nprovisioner: kubernetes.io/azure-disk\nreclaimPolicy: Delete\nvolumeBindingMode: WaitForFirstConsumer\nparameters:\n  storageaccounttype: Standard_LRS\n")),(0,l.kt)("p",null,"Apply it"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"\u276f kubectl apply -f azure-disk-sc.yaml\nstorageclass.storage.k8s.io/xld-operator-azuredisk created\n")),(0,l.kt)("p",null,"Check storage class, it should be something like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"\u276f kubectl get storageclass\nNAME                               PROVISIONER                RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE\nazurefile                          kubernetes.io/azure-file   Delete          Immediate              true                   49m\nazurefile-premium                  kubernetes.io/azure-file   Delete          Immediate              true                   49m\ndefault                            kubernetes.io/azure-disk   Delete          WaitForFirstConsumer   true                   49m\nmanaged-premium                    kubernetes.io/azure-disk   Delete          WaitForFirstConsumer   true                   49m\nxld-operator-azuredisk             kubernetes.io/azure-disk   Delete          WaitForFirstConsumer   false                  4m56s\nxld-operator-azurefile (default)   kubernetes.io/azure-file   Delete          Immediate              false                  29m\n")),(0,l.kt)("p",null,"It should be used now as storageClass ",(0,l.kt)("inlineCode",{parentName:"p"},"xld-operator-azurefile"),".\nSo update all occurrences of storageClass in the ",(0,l.kt)("inlineCode",{parentName:"p"},"xld_v1alpha_digitaldeploy.yaml")," to ",(0,l.kt)("inlineCode",{parentName:"p"},"xld-operator-azurefile")," value,\nexcept one under "),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spec.postgresql.common.global.storageClass")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spec.postgresql.global.storageClass")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spec.postgresql.persitence.storageClass"))),(0,l.kt)("p",null,"there should be ",(0,l.kt)("inlineCode",{parentName:"p"},"xld-operator-azuredisk"),"."),(0,l.kt)("h2",{id:"setting-up-azure-dns"},"Setting up Azure DNS"),(0,l.kt)("p",null,"Here we will setup Azure DNS. For setting up details check ",(0,l.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/aks/static-ip#apply-a-dns-label-to-the-service"},"Apply a DNS label to the service"),"."),(0,l.kt)("p",null,"The final URL will be in the following example: ",(0,l.kt)("a",{parentName:"p",href:"http://xld-operator123.germanywestcentral.cloudapp.azure.com/xl-deploy/#/explorer"},"http://xld-operator123.germanywestcentral.cloudapp.azure.com/xl-deploy/#/explorer")),(0,l.kt)("p",null,"Update ",(0,l.kt)("inlineCode",{parentName:"p"},"xld_v1alpha_digitaldeploy.yaml")," on following places:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spec.ingress.hosts")," update first element to ",(0,l.kt)("inlineCode",{parentName:"li"},"xld-operator123.germanywestcentral.cloudapp.azure.com")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spec.nginx-ingress-controller.service.annotations")," add annotation: ",(0,l.kt)("inlineCode",{parentName:"li"},"service.beta.kubernetes.io/azure-dns-label-name: xld-operator123"))),(0,l.kt)("p",null,"After successful startup of the operator, check following:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"\u276f kubectl get ing\nNAME                                      CLASS    HOSTS                                                   ADDRESS   PORTS   AGE\ndigitalaideploy-sample-digitalai-deploy   <none>   xld-operator123.germanywestcentral.cloudapp.azure.com             80      15m\n")),(0,l.kt)("p",null,"and (here check for the events, events need to be both here):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"\u276f kubectl describe service digitalaideploy-sample-nginx-ingress-controller\nName:                     digitalaideploy-sample-nginx-ingress-controller\nNamespace:                default\nLabels:                   app.kubernetes.io/component=controller\n                          app.kubernetes.io/instance=digitalaideploy-sample\n                          app.kubernetes.io/managed-by=Helm\n                          app.kubernetes.io/name=nginx-ingress-controller\n                          helm.sh/chart=nginx-ingress-controller-7.4.2\nAnnotations:              meta.helm.sh/release-name: digitalaideploy-sample\n                          meta.helm.sh/release-namespace: default\n                          service.beta.kubernetes.io/azure-dns-label-name: xld-operator123\nSelector:                 app.kubernetes.io/component=controller,app.kubernetes.io/instance=digitalaideploy-sample,app.kubernetes.io/name=nginx-ingress-controller\nType:                     LoadBalancer\nIP Families:              <none>\nIP:                       10.0.212.10\nIPs:                      10.0.212.10\nLoadBalancer Ingress:     20.79.230.4\nPort:                     http  80/TCP\nTargetPort:               http/TCP\nNodePort:                 http  30834/TCP\nEndpoints:                10.244.1.10:80\nPort:                     https  443/TCP\nTargetPort:               https/TCP\nNodePort:                 https  31593/TCP\nEndpoints:                10.244.1.10:443\nSession Affinity:         None\nExternal Traffic Policy:  Cluster\nEvents:\n  Type    Reason                Age   From                Message\n  ----    ------                ----  ----                -------\n  Normal  EnsuringLoadBalancer  16m   service-controller  Ensuring load balancer\n  Normal  EnsuredLoadBalancer   16m   service-controller  Ensured load balancer\n")),(0,l.kt)("h2",{id:"start-operator"},"Start operator"),(0,l.kt)("p",null,"Run following command"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"xl apply -v -f digital-ai.yaml \n")),(0,l.kt)("p",null,"Check services in shell:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"\u276f kubectl get services\nNAME                                                              TYPE           CLUSTER-IP     EXTERNAL-IP   PORT(S)                                 AGE\ncontroller-manager-metrics-service                                ClusterIP      10.0.104.207   <none>        8443/TCP                                4m37s\ndigitalaideploy-sample-digitalai-deploy-lb                        ClusterIP      10.0.243.11    <none>        4516/TCP                                3m25s\ndigitalaideploy-sample-digitalai-deploy-master                    ClusterIP      None           <none>        8180/TCP                                3m25s\ndigitalaideploy-sample-digitalai-deploy-worker                    ClusterIP      None           <none>        8180/TCP                                3m25s\ndigitalaideploy-sample-nginx-ingress-controller                   LoadBalancer   10.0.212.10    20.79.230.4   80:30834/TCP,443:31593/TCP              3m25s\ndigitalaideploy-sample-nginx-ingress-controller-default-backend   ClusterIP      10.0.104.158   <none>        80/TCP                                  3m25s\ndigitalaideploy-sample-postgresql                                 ClusterIP      10.0.15.27     <none>        5432/TCP                                3m25s\ndigitalaideploy-sample-postgresql-headless                        ClusterIP      None           <none>        5432/TCP                                3m25s\ndigitalaideploy-sample-rabbitmq                                   ClusterIP      10.0.31.132    <none>        5672/TCP,4369/TCP,25672/TCP,15672/TCP   3m25s\ndigitalaideploy-sample-rabbitmq-headless                          ClusterIP      None           <none>        4369/TCP,5672/TCP,25672/TCP,15672/TCP   3m25s\nkubernetes                                                        ClusterIP      10.0.0.1       <none>        443/TCP                                 3h3m\n")),(0,l.kt)("p",null,"The final result on Azure Portal, all should be running (running all with 1 replica) with list of pods and services :\n",(0,l.kt)("img",{alt:"aks-pods",src:a(6409).Z}),"\n",(0,l.kt)("img",{alt:"aks-services",src:a(5684).Z})),(0,l.kt)("h3",{id:"troubleshouting"},"Troubleshouting"),(0,l.kt)("p",null,"There are possible problems during deployment:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"if deployment fails because not matching namespace, just remove nemaspeace from the yaml file ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"for example during ",(0,l.kt)("inlineCode",{parentName:"li"},"Create Service controller-manager-metrics-service"),". Just remove namespace from the xld-operator-setup/config/rbac/auth-proxy-service.yaml")))),(0,l.kt)("h2",{id:"delete-the-cluster"},"Delete the cluster"),(0,l.kt)("p",null,"Clean up your unnecessary resources, use the az group delete command to remove the resource group, container service, and all related resources."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"\u276f az group delete --name xld-operator-group --yes --no-wait\n")))}d.isMDXComponent=!0},6409:function(e,t,a){t.Z=a.p+"assets/images/aks-pods-7a99bb313aadb7c4e265e463698033d3.png"},5684:function(e,t,a){t.Z=a.p+"assets/images/aks-services-a2e5d51614b63f661cb467afd5cdacb4.png"},9503:function(e,t,a){t.Z=a.p+"assets/images/aks-xld-operator-cluster-6f65ec20c609fcf6b5a99406692e37d0.png"}}]);